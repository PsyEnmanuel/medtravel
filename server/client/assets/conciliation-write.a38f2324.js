import{az as ve,m as ce,r as H,l as ae,n as ie,a0 as E,w as ye,$ as me,t as u,G as U,z as l,x as c,aB as be,U as F,V as le,v,aC as ge,Q as g,A as xe,aD as _e,aE as we,ao as Ee,aF as Re,am as Ae,a2 as C,B as r,aG as Pe,aH as Se,aI as R,y as o,F as A,aJ as S,aK as T,D as V,H as w,aL as ke,I as he,aM as h,aN as N,ah as Te,aO as qe,aP as Oe,E as ee,W as M,a6 as Qe,a7 as Ne,aQ as pe,aR as te,_ as Be,aS as re,ar as ne,aT as fe,ap as Me,a4 as ue,aU as Ge,aV as ze,aW as Fe,M as Ye,ac as je,L as Ke,K as Le,aX as We,a1 as He}from"./index.eccc4231.js";const Je={class:"w-full"},Xe={key:4,class:"flex flex-nowrap w-auto"},Ze={class:"flex flex-col ml-1"},et={__name:"ConciliationItems",props:{items:Array,isEdit:Boolean},emits:["setItems"],setup(K,{emit:k}){const{t:_}=ve();ce();const Y=H(),q=ae("$api"),j=K,I=k,D=ie({timeout:null,timeoutRow:null,columns:[{name:"date",label:"Fecha",field:"date",align:"left",classes:"min-w-[150px]"},{name:"provider",label:"Proveedor",field:"provider",align:"left",classes:"min-w-[250px]"},{name:"user_description",label:"Prestador de Servicios",field:"user_description",align:"left",classes:"min-w-[150px]"},{name:"item_description",label:"CPT",field:"item_description",align:"left",classes:"min-w-[250px]"},{name:"billed_amount",label:_("MONTO FACTURADO"),field:"billed_amount",align:"left",classes:"min-w-[100px]"},{name:"discount",label:_("DESCUENTO DE AJUSTE"),field:"discount",align:"left",classes:"min-w-[100px]"},{name:"coverage",label:_("MONTO A PROCESAR"),field:"coverage",align:"left",classes:"min-w-[100px]"},{name:"deductible",label:_("DEDUCIBLE"),field:"deductible",align:"left",classes:"min-w-[100px]"},{name:"copago",label:_("COPAGO"),field:"copago",align:"left",classes:"min-w-[100px]"},{name:"covered",label:_("CUBIERTO"),field:"covered",align:"left",classes:"min-w-[100px]"},{name:"insurance_payment",label:_("PAGO DE ASEGURADA"),field:"insurance_payment",align:"left",classes:"min-w-[100px]"},{name:"insurance_responsability",label:_("RESP. ASEGURADA"),field:"insurance_responsability",align:"left",classes:"min-w-[100px]"},{name:"insurance_claim",label:_("insurance_claim"),field:"insurance_claim",align:"left",classes:"min-w-[100px]"},{name:"note",label:_("NOTA"),field:"note",align:"left",classes:"min-w-[100px]"}],rows:[]}),G=E(()=>D.rows.filter(i=>i.c_status&4));ye(()=>D.rows,i=>{clearTimeout(D.timeout),D.timeout=setTimeout(()=>{I("setItems",D.rows)},300)},{deep:!0});const e=H([]),P=i=>{e.value[i]&&e.value[i].hide()};function B(i){i.quantity?i.quantity=parseInt(i.quantity)+1:i.quantity=1}function z(i){parseInt(i.quantity)>1&&(i.quantity=parseInt(i.quantity)-1)}function x(i){const p=h(i.billed_amount||0),n=h(i.discount||0);i.coverage=N(p-n)}function Q(i){const p=h(i.coverage||0),n=h(i.deductible||0);p&&n&&(i.covered=p-n)}function f(i){const p=h(i.coverage||0),n=h(i.copago||0);p&&n&&(i.covered=p-n)}async function $(i,p){try{const n=await q.get(`provider/${i}`);p.provider_id=String(n.id),p.provider_description=n.description}catch(n){console.log(n)}}function y(i){try{i.provider_id=null,i.provider_description=null}catch(p){console.log(p)}}async function L(i,p){try{const n=await q.get(`doctor/${i}`);p.doctor_id=n.id,p.doctor_description=n.description,setItinerary()}catch(n){console.log(n)}}function J(i){try{i.doctor_id=null,i.doctor_description=null,setItinerary()}catch(p){console.log(p)}}function W(i){const p=h(i.insurance_payment||0),n=h(i.deductible||0);i.insurance_responsability=p-n}async function oe(i,p){try{const n=await q.get(`CPT/${i}`);p.item_description=n.description,p.item_id=n.id,p.item_code=n.code}catch(n){console.log(n)}}async function se(i){try{if(j.isEdit){i.c_status=1;return}i.user_id=null,i.user_description=null,i.item_id=null,i.item_description=null,i.item_code=null,i.billed_amount=null,i.discount=null,i.coverage=null,i.deductible=null,i.covered=null,i.insurance_payment=null,i.insurance_responsability=null,i.insurance_claim=null,i.note=null}catch(p){console.log(p)}}const X=()=>({c_status:4,user_id:null,user_description:null,item_description:null,quantity:1,reset:0,billed_amount:null,coverage:null,deductible:null,covered:null,insurance_payment:null,insurance_responsability:null,insurance_claim:null,note:null});function de(){D.rows.push(X())}return me(()=>{D.rows=j.items.concat(Array.from({length:5},()=>X()))}),(i,p)=>(u(),U("div",Je,[l(he,{"hide-pagination":"","rows-per-page-options":[0],rows:G.value,columns:D.columns,"row-key":"id",ref_key:"tableRef",ref:Y,onRequest:i.onRequest,flat:"",loading:D.loading,"wrap-cells":!0},{body:c(n=>[l(be,{props:n},{default:c(()=>[(u(!0),U(F,null,le(n.cols,b=>(u(),v(ge,{class:"text-xxs",key:b.name,props:n},{default:c(()=>[b.name==="date"?(u(),v(g,{key:0,dense:"",outlined:"",modelValue:n.row.book_date,"onUpdate:modelValue":s=>n.row.book_date=s,mask:"##-##-####",label:i.$t("date"),rules:[i.requiredInput],"hide-bottom-space":""},{append:c(()=>[l(xe,{name:"event",class:"cursor-pointer"},{default:c(()=>[l(_e,{ref_for:!0,ref:"popupRefs"},{default:c(()=>[l(we,{flat:"",modelValue:n.row.book_date,"onUpdate:modelValue":[s=>n.row.book_date=s,s=>P(n.rowIndex)],"no-unset":"","years-in-month-view":"",minimal:"",mask:"DD-MM-YYYY"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue","label","rules"])):b.name==="provider"?(u(),v(Ee,{key:1,onSetProvider:s=>$(s,n.row),onClearProvider:s=>y(n.row),"model-value":n.row.provider_description,id:n.row.provider_id},null,8,["onSetProvider","onClearProvider","model-value","id"])):b.name==="user_description"?(u(),v(Re,{key:2,onSetDoctor:s=>L(s,n.row),onClearDoctor:s=>J(n.row),"model-value":n.row.doctor_description,id:n.row.doctor_id},null,8,["onSetDoctor","onClearDoctor","model-value","id"])):b.name==="item_description"?(u(),v(Ae,{key:3,onSetProcedure:s=>oe(s,n.row),onClearInsured:s=>se(n.row),"model-value":n.row.item_description,id:n.row.item_id},null,8,["onSetProcedure","onClearInsured","model-value","id"])):b.name==="quantity"?(u(),U("div",Xe,[C(l(g,{modelValue:n.row.quantity,"onUpdate:modelValue":s=>n.row.quantity=s,dense:"",outlined:"",class:"w-[50px]","data-maska":r(Pe),"data-maska-tokens":r(Se)},null,8,["modelValue","onUpdate:modelValue","data-maska","data-maska-tokens"]),[[r(R)]]),o("div",Ze,[l(A,{flat:"",class:"button bg-primary-light px-2 py-0.5 h-fit mb-0.5",size:"xs",icon:"add",onClick:s=>B(n.row)},null,8,["onClick"]),l(A,{flat:"",class:"button bg-danger-light px-2 py-0.5 h-fit",size:"xs",rounded:"",icon:"remove",onClick:s=>z(n.row)},null,8,["onClick"])])])):b.name==="billed_amount"?C((u(),v(g,{key:5,readonly:!n.row.item_id,"input-class":"text-right",dense:"",outlined:"",modelValue:n.row.billed_amount,"onUpdate:modelValue":[s=>n.row.billed_amount=s,s=>x(n.row)],"data-maska":"0.99","data-maska-tokens":r(S),"hide-bottom-space":""},null,8,["readonly","modelValue","onUpdate:modelValue","data-maska-tokens"])),[[r(R),void 0,r(T)]]):b.name==="discount"?C((u(),v(g,{key:6,readonly:!n.row.item_id,"input-class":"text-right",dense:"",outlined:"",modelValue:n.row.discount,"onUpdate:modelValue":[s=>n.row.discount=s,s=>x(n.row)],"data-maska":"0.99","data-maska-tokens":r(S),"hide-bottom-space":""},null,8,["readonly","modelValue","onUpdate:modelValue","data-maska-tokens"])),[[r(R),void 0,r(T)]]):b.name==="coverage"?C((u(),v(g,{key:7,readonly:!n.row.item_id,"input-class":"text-right",dense:"",outlined:"",modelValue:n.row.coverage,"onUpdate:modelValue":[s=>n.row.coverage=s,s=>Q(n.row)],"data-maska":"0.99","data-maska-tokens":r(S),"hide-bottom-space":""},null,8,["readonly","modelValue","onUpdate:modelValue","data-maska-tokens"])),[[r(R),void 0,r(T)]]):b.name==="deductible"?C((u(),v(g,{key:8,readonly:!n.row.item_id,"input-class":"text-right",dense:"",outlined:"",modelValue:n.row.deductible,"onUpdate:modelValue":[s=>n.row.deductible=s,s=>{Q(n.row),W(n.row)}],"data-maska":"0.99","data-maska-tokens":r(S),"hide-bottom-space":""},null,8,["readonly","modelValue","onUpdate:modelValue","data-maska-tokens"])),[[r(R),void 0,r(T)]]):b.name==="copago"?C((u(),v(g,{key:9,readonly:!n.row.item_id,"input-class":"text-right",dense:"",outlined:"",modelValue:n.row.copago,"onUpdate:modelValue":[s=>n.row.copago=s,s=>{f(n.row),W(n.row)}],"data-maska":"0.99","data-maska-tokens":r(S),"hide-bottom-space":""},null,8,["readonly","modelValue","onUpdate:modelValue","data-maska-tokens"])),[[r(R),void 0,r(T)]]):b.name==="covered"?C((u(),v(g,{key:10,readonly:!n.row.item_id,"input-class":"text-right",dense:"",outlined:"",modelValue:n.row.covered,"onUpdate:modelValue":s=>n.row.covered=s,"data-maska":"0.99","data-maska-tokens":r(S),"hide-bottom-space":""},null,8,["readonly","modelValue","onUpdate:modelValue","data-maska-tokens"])),[[r(R),void 0,r(T)]]):b.name==="insurance_payment"?C((u(),v(g,{key:11,readonly:!n.row.item_id,"input-class":"text-right",dense:"",outlined:"",modelValue:n.row.insurance_payment,"onUpdate:modelValue":[s=>n.row.insurance_payment=s,s=>W(n.row)],"data-maska":"0.99","data-maska-tokens":r(S),"hide-bottom-space":""},null,8,["readonly","modelValue","onUpdate:modelValue","data-maska-tokens"])),[[r(R),void 0,r(T)]]):b.name==="insurance_responsability"?C((u(),v(g,{key:12,readonly:"","input-class":"text-right",dense:"",outlined:"",modelValue:n.row.insurance_responsability,"onUpdate:modelValue":s=>n.row.insurance_responsability=s,"data-maska":"0.99","data-maska-tokens":r(S),"hide-bottom-space":""},null,8,["modelValue","onUpdate:modelValue","data-maska-tokens"])),[[r(R),void 0,r(T)]]):b.name==="insurance_claim"?(u(),v(g,{key:13,readonly:!n.row.item_id,dense:"",outlined:"",modelValue:n.row.insurance_claim,"onUpdate:modelValue":s=>n.row.insurance_claim=s,"hide-bottom-space":""},null,8,["readonly","modelValue","onUpdate:modelValue"])):b.name==="note"?(u(),v(g,{key:14,readonly:!n.row.item_id,dense:"",outlined:"",modelValue:n.row.note,"onUpdate:modelValue":s=>n.row.note=s,"hide-bottom-space":""},null,8,["readonly","modelValue","onUpdate:modelValue"])):(u(),U(F,{key:15},[V(w(b.value),1)],64))]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"no-data":c(({icon:n,message:b,filter:s})=>[l(ke,{icon:n,message:b,filter:s},null,8,["icon","message","filter"])]),bottom:c(()=>[l(A,{flat:"",class:"button bg-primary-light w-full mt-2","no-caps":"",onClick:de},{default:c(()=>[V("Agregar m\xE1s lineas")]),_:1})]),_:1},8,["rows","columns","onRequest","loading"])]))}},tt={class:"w-full"},nt=o("div",{class:"subtitle text-xs text-center"},"Pagos",-1),at={__name:"ConciliationPayment",props:{items:Array,isEdit:Boolean},emits:["setItems"],setup(K,{emit:k}){const{t:_}=ve();ce();const Y=H();ae("$api");const q=K,j=k,I=ie({timeout:null,timeoutRow:null,columns:[{name:"date",label:"Fecha",field:"date",align:"left",classes:"min-w-[150px]"},{name:"description",label:_("DESC."),field:"description",align:"left",classes:"min-w-[100px]"},{name:"note",label:_("NOTA"),field:"note",align:"left",classes:"min-w-[100px]"},{name:"insurance_payment",label:_("PAGO DE ASEGURADA"),field:"insurance_payment",align:"left",classes:"min-w-[100px]"},{name:"insurance_responsability",label:_("RESP. ASEGURADA"),field:"insurance_responsability",align:"left",classes:"min-w-[100px]"}],rows:[]}),D=E(()=>I.rows.filter(x=>x.c_status&4));ye(()=>I.rows,x=>{clearTimeout(I.timeout),I.timeout=setTimeout(()=>{j("setItems",I.rows)},300)},{deep:!0});const G=H([]),e=x=>{G.value[x]&&G.value[x].hide()};function P(x){const Q=h(x.insurance_payment||0),f=h(x.deductible||0);x.insurance_responsability=Q-f}const B=()=>({book_date:Te(new Date,"dd-MM-yyyy"),c_status:4,quantity:1,reset:0,insurance_payment:null,insurance_responsability:null,note:null});function z(){I.rows.push(B())}return me(()=>{I.rows=q.items.concat(Array.from({length:2},()=>B()))}),(x,Q)=>(u(),U("div",tt,[nt,l(he,{"hide-pagination":"","rows-per-page-options":[0],rows:D.value,columns:I.columns,"row-key":"id",ref_key:"tableRef",ref:Y,onRequest:x.onRequest,flat:"",loading:I.loading,"wrap-cells":!0},{body:c(f=>[l(be,{props:f},{default:c(()=>[(u(!0),U(F,null,le(f.cols,$=>(u(),v(ge,{class:"text-xxs",key:$.name,props:f},{default:c(()=>[$.name==="date"?(u(),v(g,{key:0,dense:"",outlined:"",modelValue:f.row.book_date,"onUpdate:modelValue":y=>f.row.book_date=y,mask:"##-##-####",label:x.$t("date"),rules:[x.requiredInput],"hide-bottom-space":""},{append:c(()=>[l(xe,{name:"event",class:"cursor-pointer"},{default:c(()=>[l(_e,{ref_for:!0,ref:"popupRefs"},{default:c(()=>[l(we,{flat:"",modelValue:f.row.book_date,"onUpdate:modelValue":[y=>f.row.book_date=y,y=>e(f.rowIndex)],"no-unset":"","years-in-month-view":"",minimal:"",mask:"DD-MM-YYYY"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue","label","rules"])):$.name==="description"?(u(),v(g,{key:1,dense:"",outlined:"",modelValue:f.row.description,"onUpdate:modelValue":y=>f.row.description=y,"hide-bottom-space":""},null,8,["modelValue","onUpdate:modelValue"])):$.name==="note"?(u(),v(g,{key:2,dense:"",outlined:"",modelValue:f.row.note,"onUpdate:modelValue":y=>f.row.note=y,"hide-bottom-space":""},null,8,["modelValue","onUpdate:modelValue"])):$.name==="insurance_payment"?C((u(),v(g,{key:3,"input-class":"text-right",dense:"",outlined:"",modelValue:f.row.insurance_payment,"onUpdate:modelValue":[y=>f.row.insurance_payment=y,y=>P(f.row)],"data-maska":"0.99","data-maska-tokens":r(S),"hide-bottom-space":""},null,8,["modelValue","onUpdate:modelValue","data-maska-tokens"])),[[r(R),void 0,r(T)]]):$.name==="insurance_responsability"?C((u(),v(g,{key:4,"input-class":"text-right",dense:"",outlined:"",modelValue:f.row.insurance_responsability,"onUpdate:modelValue":y=>f.row.insurance_responsability=y,"data-maska":"0.99","data-maska-tokens":r(S),"hide-bottom-space":""},null,8,["modelValue","onUpdate:modelValue","data-maska-tokens"])),[[r(R),void 0,r(T)]]):(u(),U(F,{key:5},[V(w($.value),1)],64))]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"no-data":c(({icon:f,message:$,filter:y})=>[l(ke,{icon:f,message:$,filter:y},null,8,["icon","message","filter"])]),bottom:c(()=>[l(A,{flat:"",class:"button bg-primary-light w-full mt-2","no-caps":"",onClick:z},{default:c(()=>[V("Agregar m\xE1s lineas")]),_:1})]),_:1},8,["rows","columns","onRequest","loading"])]))}},it={class:"flex md:flex-nowrap justify-between mb-2"},lt={class:"w-[300px] min-w-[300px]"},ot={key:0,class:"flex flex-col"},st={class:"text-xs"},dt={class:"flex items-center"},rt={class:"text-xs"},ut=o("span",null,"\xA0-\xA0",-1),ct={class:"text-xs"},mt=o("span",null,"\xA0-\xA0",-1),_t={class:"text-xs"},pt={class:"grid lg:grid-cols-4 grid-cols-2 gap-2 w-[600px]"},ft={class:"flex flex-nowrap w-full"},vt={class:"flex flex-col w-full"},yt={class:"text-font text-right text-md"},bt={class:"flex flex-col"},gt={class:"text-font text-right text-md"},xt={class:"flex flex-col"},wt={class:"text-font text-right text-md"},kt={class:"flex flex-col"},ht={class:"text-font text-right text-md"},Vt={class:"flex flex-col"},$t={class:"text-font text-right text-md"},Ut={class:"flex flex-col"},It={class:"text-font text-right text-md"},Dt={class:"flex flex-col"},Ct={class:"text-font text-right text-md"},Et={class:"flex flex-col"},Rt={class:"text-font text-right text-md"},At={class:"flex flex-nowrap w-full"},Pt={class:"grid grid-cols-6 gap-2"},St={class:"col-span-5 flex md:flex-nowrap gap-2"},Tt={class:"w-full"},qt={key:0,class:"mt-2"},Ot={class:"flex flex-col gap-1 mb-1"},Qt=o("div",{class:"subtitle text-xs text-center"},"Moneda",-1),Nt=o("div",{class:"subtitle text-xs text-center"},"\xC1rea",-1),Bt={class:"flex flex-col gap-1"},Mt=o("div",{class:"subtitle text-center text-xs"},"Diagn\xF3sticos",-1),Gt={class:"w-full flex flex-col justify-between border card shadow-none px-3 py-1"},zt={class:"text-xs uppercase line-clamp-1"},Ft={class:"text-xs uppercase line-clamp-1"},Yt={class:"flex flex-col gap-1"},jt=o("div",{class:"subtitle text-center text-xs"},"Notas",-1),Kt={class:"w-full max-w-[40px] min-w-[40px] flex justify-center items-center border card shadow-none"},Lt={class:"w-full flex flex-col justify-between border card shadow-none px-3 py-1"},Wt=["title"],Ht={class:"text-xs uppercase pr-4 line-clamp-1"},Jt={class:"fixed bottom-0 right-0 py-2 bg-white w-full"},Xt={class:"flex flex-nowrap gap-2 px-2 mt-1"},en={__name:"conciliation-write",props:{id:Number,eventId:String,width:String,isDrawer:Boolean},setup(K){const k=K,_=ae("$api"),Y=ae("$cats"),q=ce(),j=qe(),I=H(),D=ie({currency:Y.value.currency,policy_branch:Y.value.policy_branch}),G=()=>({diagnosis:[],notes:[],$book_state_id:50,$currency_id:14,book_date:We(new Date)}),e=ie({payments:[],submitting:!1,loading:!0,event:{},items:[],item:G()}),P=E(()=>Boolean(k.id)),B=E(()=>{const a=e.items.reduce((t,d)=>(d.c_status&1||(t+=h(d.coverage)||0),t),0);return N(a)}),z=E(()=>{const a=e.items.reduce((t,d)=>(d.c_status&1||(t+=h(d.discount)||0),t),0);return N(a)}),x=E(()=>{const a=e.items.reduce((t,d)=>(d.c_status&1||(t+=h(d.billed_amount)||0),t),0);return N(a)}),Q=E(()=>{const a=e.items.reduce((t,d)=>(d.c_status&1||(t+=h(d.deductible)||0),t),0);return N(a)}),f=E(()=>{const a=e.items.reduce((t,d)=>(d.c_status&1||(t+=h(d.copago)||0),t),0);return N(a)}),$=E(()=>{const a=e.items.reduce((t,d)=>(d.c_status&1||(t+=h(d.covered)||0),t),0);return N(a)}),y=E(()=>{const a=e.items.reduce((t,d)=>(d.c_status&1||(t+=h(d.insurance_payment)||0),t),0);return N(a)}),L=E(()=>{const a=e.items.reduce((t,d)=>(d.c_status&1||(t+=h(d.insurance_responsability)||0),t),0);return N(a)});async function J(a){try{if(!a)return;const t=await _.get(`insured/${a}`);if(!k.isEdit&&t.policies){const d=t.policies[0];i(d)}e.item.insured_id=t.id,e.item.insured_description=t.fullname}catch(t){console.log(t)}}function W(){e.item.insured_id=null,e.item.insured=null,p()}async function oe(a){try{if(!a)return;const t=await _.get(`insured/${a}`);e.item.titular_id=t.id,e.item.titular_description=t.fullname}catch(t){console.log(t)}}function se(){e.item.titular_id=null,e.item.titular=null}function X(){e.item.notes.push({id:e.item.notes.length?e.item.notes[e.item.notes.length-1].id+1:1,description:e.note}),e.note=null}function de(a){const t=e.item.notes.findIndex(d=>d.id===a);e.item.notes.splice(t,1)}async function i(a){e.item.insured_id||(e.item.insured_id=a.insured_id,e.item.insured_description=a.insured_description),e.item.insurance_id=a.insurance_id,e.item.insurance_description=a.insurance,e.item.titular_id=a.titular_id,e.item.titular_description=a.titular_description,e.item.insured_code=a.insured_code,e.item.deductible=a.deductible,e.item.policy_id=a.id,e.item.policy_number=a.policy_number,e.item.policy_branch=a.policy_branch,e.item.$policy_branch_id=a.$policy_branch_id}async function p(){e.item.insurance_id=null,e.item.insurance_description=null,e.item.titular_id=null,e.item.titular_description=null,e.item.insured_code=null,e.item.policy_id=null,e.item.policy_number=null,e.item.deductible=null}async function n(a){try{const t=await _.get(`ICD10/${a}`);if(e.item.diagnosis.findIndex(O=>O.id===a)!==-1){q.notify({type:"warning",message:"Diagn\xF3stico ya esta agregado"});return}e.item.diagnosis.push({id:t.id,code:t.code,description:t.description}),e.item.diagnosis_description=null,e.item.diagnosis_id=null}catch(t){console.log(t)}}function b(){try{e.item.diagnosis_id=null,e.item.diagnosis_description=null}catch(a){console.log(a)}}function s(a){try{const t=e.item.diagnosis.findIndex(d=>d.id===a);e.item.diagnosis.splice(t,1)}catch(t){console.log(t)}}function Ve(){e.item=G(),setTimeout(()=>{I.value.resetValidation()}),Z()}async function $e(){e.submitting=!0;const a=await _.get(`conciliation/pdf/${k.id}`);He(a,`${e.item.code}-${e.item.insurance_description}`.toUpperCase()),e.submitting=!1}async function Ue(){try{if(P.value){const a=e.items.filter(d=>d.item_id);if(!a.length){q.notify({type:"success",message:"Es requerido que la reconcilici\xF3n tenga por lo menos 1 CPT"});return}const t=await _.put(`conciliation/${k.id}`,{book:{...e.item,billed_amount_total:x.value,coverage_total:B.value,discount_total:z.value,deductible_total:Q.value,copago_total:f.value,covered_total:$.value,insurance_payment_total:y.value,insurance_responsability_total:L.value},book_items:a,book_payments:e.payments});t&&(q.notify({type:"success",message:`Reconciliaci\xF3n Editada ${t.code}`}),location.reload(),Z())}else{const a=await _.post("conciliation",{book:{...e.item,billed_amount_total:x.value,coverage_total:B.value,discount_total:z.value,deductible_total:Q.value,copago_total:f.value,covered_total:$.value,insurance_payment_total:y.value,insurance_responsability_total:L.value},book_items:e.items.filter(t=>t.c_status===4&&t.item_id),book_payments:e.payments.filter(t=>t.c_status===4)});k.eventId&&_.put(`event/general/${k.eventId}`,{book_code:a.code}),a&&(q.notify({type:"success",message:`Reconciliaci\xF3n agregada ${a.code}`}),await _.get(`conciliation/pdf/${a.code}`),Ve(),j.push("/"),Z())}}catch(a){console.log(a)}}async function Z(){try{if(P.value){const{item:a,items:t,payments:d}=await _.get(`conciliation/${k.id}`);e.item=a,e.items=t,e.payments=d,e.item.event_id&&(e.event=await _.get(`event/${e.item.event_id}`)),e.loading=!1;return}if(k.eventId){e.event=await _.get(`event/${k.eventId}`),e.policy=await _.get(`policy/insured/${e.event.policy_id}`),e.item.event_id=e.event.id,i(e.policy),e.item.diagnosis=e.event.diagnosis,e.itineraries=await _.get("itinerary",{params:{where:{c_status:4,event_id:k.eventId},returnItems:!0}});for(let a=0;a<e.itineraries.length;a++){const t=e.itineraries[a];for(let d=0;d<t.mprocedure.length;d++){const O=t.mprocedure[d];e.items.push({c_status:4,book_date:t.attendance_date,item_id:O.id,item_description:O.description,provider_id:t.provider_id,provider_description:t.provider_description,quantity:1,reset:0,billed_amount:null,coverage:null,deductible:null,covered:null,insurance_payment:null,insurance_responsability:null,insurance_claim:null,note:null})}}await J(e.event.insured_id),e.item.user_id=e.event.user_id,e.item.user_description=e.event.user_description}e.loading=!1}catch(a){console.log(a)}}me(()=>{Z()});const Ie=E(()=>({width:k.width,"padding-right":k.isDrawer&&"8px","padding-left":k.isDrawer&&"8px"}));return(a,t)=>{const d=Oe("loading");return e.loading?ee("",!0):(u(),U("div",{key:0,style:Le(Ie.value),class:"relative pb-32 px-4"},[l(Fe,{ref_key:"mainForm",ref:I,onSubmit:Ue},{default:c(()=>{var O;return[o("div",it,[o("div",lt,[(O=e.event)!=null&&O.id?(u(),U("div",ot,[o("span",st,w(e.event.contact_description),1),o("div",dt,[o("span",rt,"#"+w(e.event.code),1),ut,o("span",ct,w(e.event.event_type),1),mt,o("span",_t,w(e.event.event_state),1)]),l(A,{flat:"",class:"button bg-btn-green rounded-md w-full",label:"Abrir Coordinaci\xF3n","no-caps":"",onClick:t[0]||(t[0]=m=>{e.dialogWriteEvent=!0})})])):ee("",!0)]),o("div",pt,[o("div",ft,[o("div",vt,[l(M,{class:"text-xxs text-font bg-stone-200 rounded"},{default:c(()=>[V("Total Reconciliaci\xF3n")]),_:1}),o("span",yt,w(a.$currency(x.value)),1)])]),o("div",bt,[l(M,{class:"text-xxs text-font bg-stone-200 rounded"},{default:c(()=>[V("Descuento de Ajuste")]),_:1}),o("span",gt,w(a.$currency(z.value)),1)]),o("div",xt,[l(M,{class:"text-xxs text-font bg-stone-200 rounded"},{default:c(()=>[V("Monto a Procesar")]),_:1}),o("span",wt,w(a.$currency(B.value)),1)]),o("div",kt,[l(M,{class:"text-xxs text-font bg-stone-200 rounded"},{default:c(()=>[V("DEDUCIBLE")]),_:1}),o("span",ht,w(a.$currency(Q.value)),1)]),o("div",Vt,[l(M,{class:"text-xxs text-font bg-stone-200 rounded"},{default:c(()=>[V("COPAGO")]),_:1}),o("span",$t,w(a.$currency(f.value)),1)]),o("div",Ut,[l(M,{class:"text-xxs text-font bg-stone-200 rounded"},{default:c(()=>[V("CUBIERTO")]),_:1}),o("span",It,w(a.$currency($.value)),1)]),o("div",Dt,[l(M,{class:"text-xxs text-font bg-stone-200 rounded"},{default:c(()=>[V("PAGO DE ASEGURADA")]),_:1}),o("span",Ct,w(a.$currency(y.value)),1)]),o("div",Et,[l(M,{class:"text-xxs text-font bg-stone-200 rounded"},{default:c(()=>[V("RESP. ASEGURADA")]),_:1}),o("span",Rt,w(a.$currency(L.value)),1)]),o("div",At,[P.value?C((u(),v(A,{key:0,flat:"",class:"button-press bg-btn-red rounded-md w-full",label:"Imprimir","no-caps":"",onClick:$e},null,512)),[[d,e.submitting]]):ee("",!0)])])]),o("div",Pt,[o("div",St,[o("div",Tt,[l(et,{items:e.items,isEdit:P.value,onSetItems:t[1]||(t[1]=m=>e.items=m)},null,8,["items","isEdit"]),l(at,{class:"pt-2",items:e.payments,isEdit:P.value,onSetItems:t[2]||(t[2]=m=>e.payments=m)},null,8,["items","isEdit"]),P.value?(u(),U("div",qt,[l(Qe,{ref_id:e.item.id,table:"t_book",file_type:"GENERAL"},null,8,["ref_id"]),l(Ne,{refId:e.item.id,refKey:"t_book"},null,8,["refId"])])):ee("",!0)])]),o("div",Ot,[l(pe,{ref:"mainInput",onSetInsured:J,onSetPolicy:i,onClearInsured:W,"model-value":e.item.insured_description,id:e.item.insured_id,rules:[r(te)]},null,8,["model-value","id","rules"]),l(pe,{readonly:"",ref:"mainInput",onSetInsured:oe,onClearInsured:se,"model-value":e.item.titular_description,id:e.item.titular_id,label:"Titular",rules:[r(te)]},null,8,["model-value","id","rules"]),l(Be,{onSetInsurance:t[3]||(t[3]=m=>a.setInsurance(m,a.row)),onClearInsurance:t[4]||(t[4]=m=>a.clearInsurance(a.row)),"model-value":e.item.insurance_description,rules:[r(te)],"hide-bottom-space":""},null,8,["model-value","rules"]),l(g,{readonly:"",dense:"",outlined:"",modelValue:e.item.policy_number,"onUpdate:modelValue":t[5]||(t[5]=m=>e.item.policy_number=m),label:a.$t("policy_number"),onKeydown:t[6]||(t[6]=re(ne(()=>{},["prevent"]),["enter"])),rules:[r(te)],"hide-bottom-space":""},null,8,["modelValue","label","rules"]),l(g,{readonly:"",dense:"",outlined:"",modelValue:e.item.insured_code,"onUpdate:modelValue":[t[7]||(t[7]=m=>e.item.insured_code=m),a.findInsuredCode],label:a.$t("insured_code"),onKeydown:t[8]||(t[8]=re(ne(()=>{},["prevent"]),["enter"])),"hide-bottom-space":""},null,8,["modelValue","label","onUpdate:modelValue"]),C(l(g,{"input-class":"text-right",dense:"",outlined:"",modelValue:e.item.deductible,"onUpdate:modelValue":t[9]||(t[9]=m=>e.item.deductible=m),label:"Deducible","data-maska":"0.99","data-maska-tokens":r(S),"hide-bottom-space":""},null,8,["modelValue","data-maska-tokens"]),[[r(R),void 0,r(T)]]),o("div",null,[Qt,l(fe,{class:"flex gap-1 text-xs",size:"sm",modelValue:e.item.$currency_id,"onUpdate:modelValue":t[10]||(t[10]=m=>e.item.$currency_id=m),"toggle-color":"secondary","toggle-text-color":"text-font",options:D.currency},null,8,["modelValue","options"])]),o("div",null,[Nt,l(fe,{class:"flex gap-1 text-xs",size:"sm",modelValue:e.item.$policy_branch_id,"onUpdate:modelValue":t[11]||(t[11]=m=>e.item.$policy_branch_id=m),"toggle-color":"secondary","toggle-text-color":"text-font",options:D.policy_branch},null,8,["modelValue","options"])]),o("div",Bt,[Mt,l(Me,{onSetDiagnosis:n,onClearInsured:b,"model-value":e.item.diagnosis_description},null,8,["model-value"]),(u(!0),U(F,null,le(e.item.diagnosis,(m,De)=>(u(),U("div",{class:"flex flex-nowrap gap-1",key:m.id},[o("div",Gt,[o("div",zt,w(m.description),1),o("div",Ft,w(m.code),1)]),l(A,{diabled:"",flat:"",class:"button-icon bg-primary text-white text-[10px] h-[40px]",icon:"fa-solid fa-xmark",onClick:Ce=>s(m.id)},{default:c(()=>[l(ue,{class:"bg-default text-black text-xs"},{default:c(()=>[V("Remover diagn\xF3stico")]),_:1})]),_:2},1032,["onClick"])]))),128))]),o("div",Yt,[jt,l(g,{dense:"",outlined:"",modelValue:e.note,"onUpdate:modelValue":t[12]||(t[12]=m=>e.note=m),label:a.$t("note"),onKeydown:t[13]||(t[13]=re(ne(()=>{},["prevent"]),["enter"])),"hide-bottom-space":"",type:"textarea"},null,8,["modelValue","label"]),l(A,{diabled:"",flat:"",class:"button bg-primary text-white text-[10px] h-[40px]",onClick:t[14]||(t[14]=m=>X()),label:"Agregar nota"})]),(u(!0),U(F,null,le(e.item.notes,(m,De)=>(u(),U("div",{class:"flex flex-nowrap gap-1",key:m.id},[o("div",Kt,w(m.id),1),o("div",Lt,[o("div",{class:"text-xs uppercase pr-4 line-clamp-1",title:m.description},[V(w(m.description)+" ",1),l(_e,null,{default:c(()=>[l(Ge,null,{default:c(()=>[V(w(m.description),1)]),_:2},1024)]),_:2},1024)],8,Wt),o("div",Ht,w(m.code),1)]),l(A,{diabled:"",flat:"",class:"button-icon bg-primary text-white text-[10px] h-[40px]",icon:"fa-solid fa-xmark",onClick:Ce=>de(m.id)},{default:c(()=>[l(ue,{class:"bg-default text-black text-xs"},{default:c(()=>[V("Remover Nota")]),_:1})]),_:2},1032,["onClick"])]))),128))])]),o("div",Jt,[l(ze,{item:e.item,isEdit:P.value},null,8,["item","isEdit"]),o("div",Xt,[k.isEdit?(u(),U(F,{key:0},[l(A,{class:"button-icon bg-primary text-white py-0",icon:"fa-solid fa-xmark",rounded:"",onClick:t[15]||(t[15]=ne(m=>a.onDelete(e.item.id),["stop"])),size:"sm"},{default:c(()=>[l(ue,{class:"bg-default text-black",size:"xs"},{default:c(()=>[V("Remover")]),_:1})]),_:1}),l(A,{class:"button-press w-full text-lg rounded-md bg-primary text-white",flat:"",label:"guardar cambios",type:"submit"})],64)):(u(),v(A,{key:1,class:"button-press w-full text-lg rounded-md bg-primary text-white",flat:"",label:"guardar cambios",type:"submit"}))])])]}),_:1},512),l(Ke,{modelValue:e.dialogWriteEvent,"onUpdate:modelValue":t[17]||(t[17]=O=>e.dialogWriteEvent=O),position:a.$isDesktop?"right":"standard","full-height":"",maximized:"","transition-duration":100},{default:c(()=>[l(Ye,null,{default:c(()=>[l(je,{onClose:t[16]||(t[16]=O=>e.dialogWriteEvent=!1),isDrawer:"",id:e.event.id,isEdit:"",width:(a.$isDesktop,"100%")},null,8,["id","width"])]),_:1})]),_:1},8,["modelValue","position"])],4))}}};export{en as default};
