import{l as D,az as z,r as x,m as E,n as I,a3 as L,w as N,t as b,G as y,y as n,z as o,x as p,A as k,Q,F as $,H as d,aC as q,I as B,U as S,bR as F,_ as T,E as C,R as V,ar as v}from"./index.49e59f77.js";const A={class:"flex justify-between md:flex-nowrap mb-1"},j={class:"flex flex-nowrap w-full gap-2"},P={class:"full-width row flex-center text-primary q-gutter-sm"},R={class:"flex gap-2"},U={class:"flex flex-col"},H={__name:"table-policy",props:{data:Array},setup(c){const _=c,f=D("$api"),{t}=z(),w=x(),l=E(),e=I({dialogWrite:!1,dialogList:!1,dialogCreate:!1,selectedId:0,dialogWidth:400,selected:[],search:"",search_key:"orlike:customer_description,policy_number,policy_branch,insured_code,insured_type,relationship,insured_description,",pagination:{sortBy:"description",descending:!1,page:1,rowsPerPage:1e3},columns:[{name:"customer_description",required:!0,label:t("customer_description"),align:"left",field:"customer_description",sortable:!0},{name:"policy_number",required:!0,label:t("policy_number"),align:"left",field:"policy_number",sortable:!0},{name:"insured_code",required:!0,label:t("insured_code"),align:"left",field:"insured_code",sortable:!0},{name:"titular_description",required:!0,label:t("titular_description"),align:"left",field:"titular_description",sortable:!0},{name:"insured_description",required:!0,label:t("insured_description"),align:"left",field:"insured_description",sortable:!0},{name:"insurance",required:!0,label:t("insurance"),align:"left",field:"insurance",sortable:!0},{name:"insurance_plan",required:!0,label:t("insurance_plan"),align:"left",field:"insurance_plan",sortable:!0},{name:"insurance_plan_type",required:!0,label:t("insurance_plan_type"),align:"left",field:"insurance_plan_type",sortable:!0},{name:"relationship",required:!0,label:t("relationship"),align:"left",field:"relationship",sortable:!0},{name:"insured_type",required:!0,label:t("insured_type"),align:"left",field:"insured_type",sortable:!0},{name:"policy_branch",required:!0,label:t("policy_branch"),align:"left",field:"policy_branch",sortable:!0},{name:"validity_date_start",required:!0,label:t("validity_date_start"),align:"left",field:"validity_date_start",sortable:!0},{name:"validity_date_end",required:!0,label:t("validity_date_end"),align:"left",field:"validity_date_end",sortable:!0}],rows:_.data}),m=L(()=>{let r;return e.search===""?r=e.rows:r=e.rows.filter(u=>e.search_key.replace("orlike:","").split(",").some(a=>String(u[a]).toLowerCase().includes(e.search.toLowerCase()))),r});N(()=>m.value,r=>{e.pagination.rowsNumber=r.length,e.pagination.page=1});async function h(){const r=await f.post("migration/insurance",e.rows);e.rows=[],e.pagination.rowsNumber=0,e.pagination.page=1,r&&l.notify({type:"success",message:"P\xF3liza subida exitosamente"})}return(r,u)=>(b(),y(S,null,[n("div",A,[n("div",j,[o(Q,{class:"w-full md:w-auto",dense:"",outlined:"",debounce:"300",modelValue:e.search,"onUpdate:modelValue":u[0]||(u[0]=a=>e.search=a),placeholder:r.$t("search")},{append:p(()=>[o(k,{name:"search"})]),_:1},8,["modelValue","placeholder"]),o($,{flat:"",class:"button h-full",icon:"upload",label:r.$isDesktop&&r.$t("Subir Polizas"),onClick:h},null,8,["label"])])]),o(B,{grid:!r.$isDesktop,"hide-pagination":"",rows:m.value,columns:e.columns,"row-key":"id",ref_key:"tableRef",ref:w,flat:"",pagination:e.pagination,"onUpdate:pagination":u[1]||(u[1]=a=>e.pagination=a),loading:e.loading,"rows-per-page-label":"Lineas","wrap-cells":!0},{"no-data":p(({icon:a,message:s,filter:i})=>[n("div",P,[n("span",null,d(s),1),o(k,{size:"2em",name:i?"filter_b_and_w":a},null,8,["name"])])]),"body-cell-action":p(a=>[o(q,{props:a},{default:p(()=>[n("div",R,[o($,{flat:"",class:"button-press bg-primary text-white rounded-md",size:"sm",label:"Editar","no-caps":"",onClick:s=>{e.selectedId=a.row.id,e.dialogWrite=!0}},null,8,["onClick"])])]),_:2},1032,["props"])]),"body-cell-insured_description":p(a=>[o(q,{props:a},{default:p(()=>[n("div",U,[n("span",null,d(a.row.insured_description),1),n("span",null,d(a.row.ident_no),1),n("span",null,d(a.row.sex),1),n("span",null,d(a.row.birthdate_format),1),n("span",null,d(a.row.age),1)])]),_:2},1032,["props"])]),_:1},8,["grid","rows","columns","pagination","loading"])],64))}},M={class:"grid grid-cols-3 gap-2 mb-1"},W={class:"w-full h-full flex flex-col items-center justify-center",for:"fileElem"},G={class:"text-lg"},O=["innerHTML"],X={key:0,class:"mt-1"},K={__name:"tool-policy",props:{ref_id:Number,table:String,icon:{type:String,default:"fa-duotone fa-solid fa-upload"},avaliable_file_text:{type:Boolean,default:!0},text:{type:String,default:"Click aqu\xED para subir archivos"},avaliable_text:{type:String,default:"<b>Se acepta: &nbsp; </b>documentos (EXCEL)"}},setup(c){const{uploadFiles:_}=F(),f=x(),t=x(!1),w=D("$api"),l=I({data:[],item:{insurance_id:35,insurance_description:"AETNA"}});function e(){t.value=!0}function m(){t.value=!1}async function h(s){t.value=!1;const i=Array.from(s.dataTransfer.files);l.data=await _({url:"file/migration/policy",files:i,insurance_id:l.item.insurance_id,insurance:l.item.insurance_description})}async function r(s){try{const i=await w.get(`insurance/${s}`);l.item.insurance_id=i.id,l.item.insurance_description=i.description}catch(i){console.log(i)}}function u(){try{l.item.insurance_id=null,l.item.insurance_description=null}catch(s){console.log(s)}}async function a(){const s=[];for(let i=0;i<f.value.files.length;i++){const g=f.value.files[i];s.push(g)}l.data=await _({url:"file/migration/policy",files:s,insurance_id:l.item.insurance_id,insurance:l.item.insurance_description})}return(s,i)=>(b(),y(S,null,[n("div",M,[o(T,{onSetInsurance:i[0]||(i[0]=g=>r(g,s.row)),onClearInsurance:i[1]||(i[1]=g=>u(s.row)),"model-value":l.item.insurance_description},null,8,["model-value"])]),n("div",{class:V(["flex flex-col justify-center items-center bg-white rounded-2xl w-full p-4 text-center border-2 border-dashed hover:border-sky-300 cursor-pointer",{"bg-sky-100":t.value}]),onDragover:v(e,["prevent"]),onDragleave:v(m,["prevent"]),onDrop:v(h,["prevent"])},[n("input",{class:"hidden",id:"fileElem",ref_key:"myFiles",ref:f,type:"file",multiple:"",onChange:a},null,544),n("label",W,[o(k,{class:"mb-2",name:c.icon,size:"48px",color:"primary"},null,8,["name"]),n("p",G,d(c.text),1),c.avaliable_file_text?(b(),y("div",{key:0,class:"text-sm max-w-[300px] text-center mt-2",innerHTML:c.avaliable_text},null,8,O)):C("",!0)])],34),l.data.length?(b(),y("div",X,[o(H,{data:l.data},null,8,["data"])])):C("",!0)],64))}};export{K as default};
