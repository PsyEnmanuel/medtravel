import{r as U,l as v,m as j,n as z,w as b,o as W,q as E,k as T,t as c,v as g,x as o,y as u,z as t,Q as L,A as x,_ as M,B as i,C as $,D as m,E as f,F as r,G as A,H as y,I as O,J as F,K as G,L as H,M as J,O as K,R as X,S as Y}from"./index.bc6d1759.js";import{_ as Z}from"./insuredCard.9bcbd00d.js";const ee={class:"flex justify-between lg:flex-nowrap mb-1"},se={class:"flex lg:flex-nowrap w-full gap-2"},le={class:"flex justify-end"},ae={key:0,class:"grid grid-flow-col auto-cols-max gap-2"},te={class:"full-width row flex-center text-primary q-gutter-sm"},ie={__name:"insured-index",props:{insuredId:Number,insuredId:Number},setup(h){var k;const C=h,n=U(),p=v("$me"),q=v("$api"),w=j(),e=z({hasPolicies:0,timePeriod:"today",dialogWrite:!1,dialogList:!1,dialogCreate:!1,selectedId:0,dialogWidth:400,selected:[],search:"",search_key:"orlike:code,ident_no,fullname",pagination:{sortBy:"code",descending:!1,page:1,rowsPerPage:20},url:"insured",query:{groupBy:["t_insured.code"],where:{c_status:4,high_profile:p.high_profile?null:0,insured_id:(k=C.insuredId)!=null?k:null}},columns:[],rows:[]});function D(l){try{e.query.where["js:policies|insurance_id"]=[l]}catch(s){console.log(s)}}function I(){try{e.query.where["js:policies|insurance_id"]=null}catch(l){console.log(l)}}const V=async function(){try{if(!(p.unixroles&1)){w.notify({type:"danger",message:"No tienes acceso para unir expedientes"});return}const l=e.selected[0].fullname,s=[...e.selected].splice(1,e.selected.length).map(d=>d.fullname);(await w.dialog({title:"Confirmar Eliminaci\xF3n de Duplicados",message:`Desea unir: ${l} -> ${s.join(", ")}`,cancel:!0,persistent:!0})).onOk(async()=>{await q.post(`${e.url}/merge`,{data:e.selected.map(d=>d.id)}),w.notify({type:"success",message:"Duplicados removidos"})})}catch(l){console.log(l)}};b(()=>e.timePeriod,l=>{W(l,e.query,"insured_date")}),b(()=>e.hasPolicies,l=>{console.log(l),l?e.query.where["isnull:policies"]=1:delete e.query.where["isnull:policies"]});const{onRequest:P,getSelectedString:S,onDeleteRows:Q,addMore:R,itemsRange:_}=E(e,n),B=T();return b(()=>B.table.t_insured,l=>{n.value.requestServerInteraction(),n.value.clearSelection()},{deep:!0}),(l,s)=>(c(),g(Y,{class:X(l.$isDesktop?h.insuredId?"px-2 py-3":"px-1.5 py-2 lg:px-5 lg:py-6":"px-1.5 py-2")},{default:o(()=>[u("div",ee,[u("div",se,[t(L,{class:"w-full md:w-auto",dense:"",outlined:"",debounce:"300",modelValue:e.search,"onUpdate:modelValue":s[0]||(s[0]=a=>e.search=a),placeholder:l.$t("search")},{append:o(()=>[t(x,{name:"search"})]),_:1},8,["modelValue","placeholder"]),t(M,{class:"lg:w-[250px] w-full",onSetInsurance:D,onClearInsurance:I,"model-value":e.query.where.insurance},null,8,["model-value"]),i(p).high_profile?(c(),g($,{key:0,class:"border border-dashed px-4 h-[40px]",modelValue:e.query.where.high_profile,"onUpdate:modelValue":s[1]||(s[1]=a=>e.query.where.high_profile=a),"true-value":1,"false-value":null},{default:o(()=>[m("Alto perfil")]),_:1},8,["modelValue"])):f("",!0),e.selected.length?(c(),g(r,{key:1,flat:"",class:"button h-full bg-primary text-white","icon-right":"sym_o_remove",label:l.$isDesktop?"Remover":"","no-caps":"",onClick:i(Q)},null,8,["label","onClick"])):f("",!0),i(p).unixroles&1&&e.selected.length>1?(c(),g(r,{key:2,flat:"",class:"button h-full bg-orange-300","icon-right":"sym_o_cell_merge",label:l.$isDesktop?"Unir":"","no-caps":"",onClick:V},null,8,["label"])):f("",!0),t($,{class:"border border-dashed px-4 h-[40px]",modelValue:e.hasPolicies,"onUpdate:modelValue":s[2]||(s[2]=a=>e.hasPolicies=a),"true-value":1,"false-value":0},{default:o(()=>[m("Sin P\xF3lizas")]),_:1},8,["modelValue"])]),u("div",le,[l.$isDesktop?(c(),A("div",ae,[t(r,{class:"bg-transparent",flat:"","no-caps":""},{default:o(()=>[m(y(i(_).start)+" - "+y(i(_).end)+" de "+y(e.pagination.rowsNumber),1)]),_:1}),t(r,{class:"bg-transparent",icon:"sym_o_first_page",flat:"",onClick:s[3]||(s[3]=a=>n.value.firstPage())}),t(r,{class:"bg-transparent",icon:"sym_o_navigate_before",flat:"",onClick:s[4]||(s[4]=a=>n.value.prevPage())}),t(r,{class:"bg-transparent",icon:"sym_o_navigate_next",flat:"",onClick:s[5]||(s[5]=a=>n.value.nextPage())}),t(r,{class:"bg-transparent",icon:"sym_o_last_page",flat:"",onClick:s[6]||(s[6]=a=>n.value.lastPage())})])):f("",!0)])]),t(O,{"table-class":"table-style-1",grid:"","hide-pagination":"",rows:e.rows,columns:e.columns,"row-key":"id",ref_key:"tableRef",ref:n,onRequest:i(P),flat:"",selection:"multiple",pagination:e.pagination,"onUpdate:pagination":s[8]||(s[8]=a=>e.pagination=a),selected:e.selected,"onUpdate:selected":s[9]||(s[9]=a=>e.selected=a),"selected-rows-label":i(S),loading:e.loading,"rows-per-page-label":"Lineas","rows-per-page-options":[10,20,50,100],"wrap-cells":!0},F({"no-data":o(({icon:a,message:d,filter:N})=>[u("div",te,[u("span",null,y(d),1),t(x,{size:"2em",name:N?"filter_b_and_w":a},null,8,["name"])])]),item:o(a=>[u("div",{class:"q-pa-xs col-lg-4 col-md-6 col-xs-12",style:G(a.selected?"transform: scale(0.95);":"")},[t(Z,{item:a,onSelectedId:s[7]||(s[7]=d=>{e.selectedId=d,e.dialogWrite=!0})},null,8,["item"])],4)]),_:2},[l.$isDesktop?void 0:{name:"bottom",fn:o(()=>[t(r,{flat:"",class:"button bg-primary-light w-full","no-caps":"",onClick:i(R)},{default:o(()=>[m("Cargar m\xE1s")]),_:1},8,["onClick"])]),key:"0"}]),1032,["rows","columns","onRequest","pagination","selected","selected-rows-label","loading"]),t(H,{class:"q-pa-none left-0","no-refocus":"",modelValue:e.dialogWrite,"onUpdate:modelValue":s[11]||(s[11]=a=>e.dialogWrite=a),position:l.$isDesktop?"right":"standard","full-height":"",maximized:"","transition-duration":l.$isDesktop?100:0},{default:o(()=>[t(J,null,{default:o(()=>[t(K,{onClose:s[10]||(s[10]=a=>{e.dialogWrite=!1}),isEdit:"",isDrawer:"",id:e.selectedId,width:l.$isDesktop?"1000px":"100%"},null,8,["id","width"])]),_:1})]),_:1},8,["modelValue","position","transition-duration"])]),_:1},8,["class"]))}};export{ie as default};
