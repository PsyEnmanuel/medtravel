import{l as k,r as F,n as G,ag as K,ah as w,ai as M,aj as E,w as p,$ as J,k as X,t as u,G as y,y as o,z as l,x as r,B as i,ak as U,al as Y,am as Z,an as ee,ao as te,ap as ae,F as v,R as _,v as W,E as V,U as D,D as $,H as g,aq as le,ar as B,a5 as ne,as as ie,M as f,ab as z,L as m,at as se,au as re,av as oe,aw as de,ax as ue,ay as ve}from"./index.e9245a9e.js";const me={class:"p-2"},ye={class:"flex md:flex-nowrap gap-2"},fe={class:"grid lg:grid-cols-3 gap-1"},ge=o("i",{class:"icon material-icons"},"arrow_back",-1),ce=o("i",{class:"icon material-icons"},"arrow_forward",-1),we={class:"flex flex-col col-span-2 gap-1"},pe={class:"grid grid-cols-2 gap-1"},_e={class:"flex flex-col gap-1"},he={class:"flex flex-col gap-1"},Ce={class:"flex flex-col gap-1"},be={class:"flex gap-1 items-end"},xe={class:"bg-white card rounded-xs main-calendar mt-1"},ke={class:"flex items-center"},Ve={key:1,class:"flex w-full cursor-pointer relative"},De=["onClick"],$e={key:0},Ie={key:0},Se={class:"bg-white card p-4"},Me={__name:"itinerary-index",props:{eventId:Number},setup(j){const h=k("$api"),s=k("$isDesktop"),d=F(),A=k("$me"),C=j,t=G({yesterday:K(new Date),eventsMonth:[],selectedId:0,selectedItinerary:0,searchKeys:"",activeView:!s||C.eventId?"day":"week",startCalendar:new Date,users:[],user:{},dialogItinerary:!1,dialogWriteItinerary:!1,dialogDetail:!1,dialogCreate:!1,dialogInsuredList:!1,columnSelected:0,timestampSelected:0,eventSelectedId:null,selectedEvent:{},events:[],loading:!0,dialogSearchEvent:!1,dayDate:null,calendar:{timeStep:15,snapToTime:30,timeCellHeight:70,timeFrom:8*60,timeTo:19*60,hideWeekDay:[]},query:{order:{attendance_datetime:"ASC"},join:[{table:"t_event",relationA:"t_event.id",relationB:"t_itinerary.event_id"}],groupBy:["t_itinerary.id"],where:{"t_itinerary.event_id":C.eventId||null,high_profile:A.high_profile?null:0,"t_itinerary.c_status":[4],"t_event.c_status":[4],user_id:null,"gt:attendance_datetime":w(M(new Date),"yyyy-MM-dd"),"lt:attendance_datetime":w(M(new Date),"yyyy-MM-dd")},mergeRows:!0},queryMonth:{order:{attendance_datetime:"ASC"},join:[],groupBy:["t_itinerary.id"],where:{"t_itinerary.event_id":C.eventId||null,c_status:[4],user_id:null,"gt:attendance_datetime":w(E(new Date),"yyyy-MM-dd"),"lt:attendance_datetime":w(E(new Date),"yyyy-MM-dd")}}});p(()=>t.query.where,async n=>{c(),I()},{deep:!0}),p(()=>t.queryMonth.where,async n=>{I()},{deep:!0}),p(()=>t.query.where.user_id,async n=>{c()},{deep:!0});async function N(n){try{t.query.where["js:mprocedure"]=n}catch(e){console.log(e)}}function P(){try{t.query.where["js:mprocedure"]=null}catch(n){console.log(n)}}async function O(n){try{t.eventSelectedId=n.id,t.dialogItinerary=!0}catch(e){console.log(e)}}function b(n){return t.activeView===n}function T(n){if(!d.value.isMonthView){if(!ve(n))return;t.timestampSelected=n,t.dialogCreate=!0}}async function H(){const n=await h.get("user",{params:{order:{description:"ASC"},group_by:"t_user.id",where:{c_status:4,"bi:unixroles":4}}});t.users=n.items.map(e=>({...e,value:e.id,label:e.description}))}async function c(){const n=await h.get("itinerary",{params:{...t.query,returnItems:!0}});t.events=n.map(e=>({...e,start:e.start_calendar,end:e.start_calendar}))}async function I(){const n=await h.get("itinerary",{params:{...t.queryMonth,returnItems:!0}});t.eventsMonth=n.map(e=>({...e,start:e.start_calendar,end:e.start_calendar}))}async function S(n){try{t.query.where["gt:attendance_datetime"]=n.startDate,t.query.where["lt:attendance_datetime"]=n.endDate}catch(e){console.log(e)}}async function q(n){try{t.queryMonth.where["gt:attendance_datetime"]=n.startDate,t.queryMonth.where["lt:attendance_datetime"]=n.endDate}catch(e){console.log(e)}}function L(n){t.startCalendar=n,t.activeView="day"}function Q(){c()}J(()=>{H()});const R=X();return p(()=>R.table.t_event,n=>{c()},{deep:!0}),(n,e)=>(u(),y(D,null,[o("div",me,[o("div",ye,[o("div",fe,[l(i(U),{class:"vuecal-small",ref_key:"vuecal",ref:d,events:t.eventsMonth,"selected-date":t.selectedDate,"onUpdate:selectedDate":e[0]||(e[0]=a=>t.selectedDate=a),"hide-view-selector":"",time:!1,"active-view":"month",xsmall:"",locale:"es",transitions:!1,onCellClick:L,onReady:q,onViewChange:q,disableViews:["week","day"]},{"arrow-prev":r(()=>[ge]),"arrow-next":r(()=>[ce]),_:1},8,["events","selected-date"]),o("div",we,[o("div",pe,[o("div",_e,[l(Y,{onSetUser:e[1]||(e[1]=a=>t.query.where.user_id=a),onClearUser:e[2]||(e[2]=a=>t.query.where.user_id=null),"model-value":t.user_description,label:"Coordinador",unixroles:24,"onUpdate:modelValue":e[3]||(e[3]=a=>n.getStats())},null,8,["model-value"]),l(Z,{class:"mb-1",onSetProcedure:e[4]||(e[4]=a=>N(a)),onClearProcedure:e[5]||(e[5]=a=>P()),"model-value":t.procedure_description},null,8,["model-value"])]),o("div",he,[l(ee,{onSetCountry:e[6]||(e[6]=a=>t.query.where.country_id=a),onClearCountry:e[7]||(e[7]=a=>t.query.where.country_id=null),"model-value":t.country},null,8,["model-value"]),l(te,{class:"w-full",onSetProvider:e[8]||(e[8]=a=>t.query.where["t_itinerary.provider_id"]=a),onClearProvider:e[9]||(e[9]=a=>t.query.where["t_itinerary.provider_id"]=null),"model-value":t.provider_description},null,8,["model-value"])]),o("div",Ce,[l(ae,{onSetDiagnosis:e[10]||(e[10]=a=>t.query.where["js:diagnosis"]=a),onClearDiagnosis:e[11]||(e[11]=a=>t.query.where["js:diagnosis"]=null),"model-value":t.diagnosis},null,8,["model-value"])])]),o("div",be,[l(v,{class:"button rounded-lg",flat:"",label:i(s)?"Buscar":"",icon:"sym_o_search",onClick:e[12]||(e[12]=a=>t.dialogSearchEvent=!0)},null,8,["label"]),l(v,{class:_(["button rounded-lg",b("day")&&"bg-primary text-white"]),flat:"",onClick:e[13]||(e[13]=a=>t.activeView="day"),label:i(s)?"Dias":"D"},null,8,["class","label"]),l(v,{class:_(["button rounded-lg",b("week")&&"bg-primary text-white"]),flat:"",onClick:e[14]||(e[14]=a=>t.activeView="week"),label:i(s)?"Semana":"S"},null,8,["class","label"]),l(v,{class:_(["button rounded-lg",b("month")&&"bg-primary text-white"]),flat:"",onClick:e[15]||(e[15]=a=>t.activeView="month"),label:i(s)?"Mes":"M"},null,8,["class","label"]),l(v,{class:"button rounded-lg",flat:"",onClick:e[16]||(e[16]=a=>{d.value.previous(),t.startCalendar=d.value.view.startDate}),icon:"navigate_before",label:i(s)&&"Anterior"},null,8,["label"]),i(s)?(u(),W(v,{key:0,class:"button rounded-lg",flat:"",onClick:e[17]||(e[17]=a=>{d.value.switchView("week",new Date),t.startCalendar=new Date}),icon:"today",label:i(s)&&"Hoy"},null,8,["label"])):V("",!0),l(v,{class:"button rounded-lg",flat:"",onClick:e[18]||(e[18]=a=>{d.value.next(),t.startCalendar=d.value.view.startDate}),"icon-right":"navigate_next",label:i(s)&&"Siguiente"},null,8,["label"])])])])]),o("div",xe,[l(i(U),{ref_key:"vuecal",ref:d,time:!1,events:t.events,"selected-date":t.startCalendar,"onUpdate:selectedDate":e[20]||(e[20]=a=>t.startCalendar=a),"active-view":t.activeView,"onUpdate:activeView":e[21]||(e[21]=a=>t.activeView=a),hideViewSelector:"",locale:"es","disable-views":["years","year"],"twelve-hour":!0,"editable-events":!1,"hide-weekdays":t.calendar.hideWeekDay,"drag-to-create-event":!1,"dblclick-to-navigate":!1,onReady:S,onCellClick:T,onViewChange:S,"events-on-month-view":"short"},{"weekday-heading":r(a=>[o("div",ke,[a.view.id==="month"?(u(),y(D,{key:0},[$(g(a.heading.label),1)],64)):(u(),y(D,{key:1},[$(g(a.heading.label)+" "+g(i(le)(a.heading.date))+" ",1),l(v,{class:"button-icon bg-default ml-2",flat:"",icon:"fa-solid fa-magnifying-glass",size:"xs",onClick:B(x=>{t.dayDate=a.heading.date,t.dialogDetail=!0},["stop"]),round:""},{default:r(()=>[l(ne,{class:"bg-default text-black text-xs"},{default:r(()=>[$("Vista tabla")]),_:1})]),_:2},1032,["onClick"])],64))])]),event:r(a=>[["day","week"].includes(a.view)?(u(),W(ie,{key:0,item:a.event,onSelected:e[19]||(e[19]=x=>{t.selectedId=x,t.dialogWrite=!0}),onOpenItinerary:O},null,8,["item"])):(u(),y("div",Ve,[o("span",{class:"text-[10px] w-full text-left px-1 line-clamp-1 ml-1",onClick:B(x=>{t.selectedId=a.event.id,t.dialogWrite=!0},["stop","prevent"])},g(a.event.request_time)+" "+g(a.event.insured),9,De),o("div",{class:_(["absolute left-0 top-0 h-full w-[4px]",a.event.color])},null,2)]))]),"cell-content":r(a=>[["week"].includes(a.view.id)?(u(),y("span",$e,[a.events.length?V("",!0):(u(),y("div",Ie," No Hay Coordinaciones "))])):V("",!0)]),_:1},8,["events","selected-date","active-view","hide-weekdays"])])]),l(m,{class:"q-pa-none left-0",modelValue:t.dialogCreate,"onUpdate:modelValue":e[23]||(e[23]=a=>t.dialogCreate=a),position:i(s)?"right":"standard","full-height":"",maximized:"","transition-duration":i(s)?100:0},{default:r(()=>[l(f,null,{default:r(()=>[l(z,{isDrawer:"",onClose:e[22]||(e[22]=a=>t.dialogCreate=!1),width:(i(s),"100%"),timestamp:t.timestampSelected,userId:t.query.where.user_id},null,8,["width","timestamp","userId"])]),_:1})]),_:1},8,["modelValue","position","transition-duration"]),l(m,{class:"q-pa-none left-0",modelValue:t.dialogWrite,"onUpdate:modelValue":e[26]||(e[26]=a=>t.dialogWrite=a),position:i(s)?"right":"standard","full-height":"",maximized:"","transition-duration":i(s)?100:0},{default:r(()=>[l(f,null,{default:r(()=>[l(z,{isDrawer:"",onSubmit:e[24]||(e[24]=a=>t.dialogWrite=!1),onClose:e[25]||(e[25]=a=>t.dialogWrite=!1),isEdit:"",id:t.selectedId,width:(i(s),"100%")},null,8,["id","width"])]),_:1})]),_:1},8,["modelValue","position","transition-duration"]),l(m,{class:"q-pa-none left-0",modelValue:t.dialogWriteItinerary,"onUpdate:modelValue":e[29]||(e[29]=a=>t.dialogWriteItinerary=a),position:i(s)?"right":"standard","full-height":"",maximized:"","transition-duration":i(s)?100:0},{default:r(()=>[l(f,null,{default:r(()=>[l(se,{isDrawer:"",onSubmit:e[27]||(e[27]=a=>t.dialogWriteItinerary=!1),onClose:e[28]||(e[28]=a=>{t.dialogWriteItinerary=!1}),isEdit:"",id:t.selectedItinerary,width:i(s)?"400px":"100%"},null,8,["id","width"])]),_:1})]),_:1},8,["modelValue","position","transition-duration"]),l(m,{class:"q-pa-none left-0","no-refocus":"",modelValue:t.dialogSearchEvent,"onUpdate:modelValue":e[32]||(e[32]=a=>t.dialogSearchEvent=a),position:i(s)?"right":"standard","full-height":"",maximized:"","transition-duration":i(s)?100:0},{default:r(()=>[l(f,null,{default:r(()=>[l(re,{onClose:e[30]||(e[30]=a=>t.dialogSearchEvent=!1),isDrawer:"",onEdit:e[31]||(e[31]=a=>{t.dialogSearchEvent=!1,t.selectedId=a,t.dialogWrite=!0}),width:i(s)?"400px":"100%"},null,8,["width"])]),_:1})]),_:1},8,["modelValue","position","transition-duration"]),l(m,{modelValue:t.dialogDetail,"onUpdate:modelValue":e[34]||(e[34]=a=>t.dialogDetail=a),"full-width":""},{default:r(()=>[o("div",Se,[l(oe,{user:t.user,date:t.dayDate,onEdit:e[33]||(e[33]=a=>{t.selectedItinerary=a,t.dialogWriteItinerary=!0})},null,8,["user","date"])])]),_:1},8,["modelValue"]),l(m,{class:"q-pa-none left-0","no-refocus":"",modelValue:t.dialogInsuredList,"onUpdate:modelValue":e[35]||(e[35]=a=>t.dialogInsuredList=a),position:i(s)?"right":"standard","full-height":"",maximized:"","transition-duration":i(s)?100:0},{default:r(()=>[l(f,null,{default:r(()=>[l(de,{event:t.selectedEvent,width:i(s)?"400px":"100%"},null,8,["event","width"])]),_:1})]),_:1},8,["modelValue","position","transition-duration"]),l(m,{modelValue:t.dialogItinerary,"onUpdate:modelValue":e[37]||(e[37]=a=>t.dialogItinerary=a),"full-height":"",maximized:""},{default:r(()=>[l(f,{class:"shadow pt-4 px-6 pb-4 flex-col w-[400px]"},{default:r(()=>[l(ue,{displayAdd:"",isEdit:"",id:t.eventSelectedId,isDrawer:"",onClose:e[36]||(e[36]=a=>t.dialogItinerary=!1),onUpdate:Q},null,8,["id"])]),_:1})]),_:1},8,["modelValue"])],64))}};export{Me as default};
