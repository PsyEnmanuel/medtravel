import{az as pe,m as de,r as J,l as ne,n as ae,a3 as E,w as be,$ as re,t as u,G as C,z as l,x as c,aK as ye,U as W,V as ue,v as b,aC as ve,Q as x,A as ge,b2 as xe,b3 as we,ao as Ue,b4 as Ie,am as De,b5 as D,B as d,b6 as Ce,b7 as Ee,b8 as R,y as s,F as O,b9 as P,ba as S,D as I,H as h,bb as ke,I as he,bc as k,bd as B,ah as Re,be as Ae,bf as Pe,E as ee,W as G,a7 as Se,ac as Te,bg as ce,aS as te,_ as qe,aT as me,ar as se,aF as _e,ap as Oe,a5 as fe,bh as Qe,aW as Be,M as Me,ab as Ge,L as Ne,K as ze,bi as Fe,a4 as Ye}from"./index.e965bcc3.js";const Ke={class:"w-full"},We={key:4,class:"flex flex-nowrap w-auto"},je={class:"flex flex-col ml-1"},Le={__name:"ConciliationItems",props:{items:Array,isEdit:Boolean},emits:["setItems"],setup(j,{emit:w}){const{t:m}=pe();de();const F=J(),T=ne("$api"),Y=j,$=w,U=ae({timeout:null,timeoutRow:null,columns:[{name:"date",label:"Fecha",field:"date",align:"left",classes:"min-w-[150px]"},{name:"provider",label:"Proveedor",field:"provider",align:"left",classes:"min-w-[250px]"},{name:"user_description",label:"Prestador de Servicios",field:"user_description",align:"left",classes:"min-w-[150px]"},{name:"item_description",label:"CPT",field:"item_description",align:"left",classes:"min-w-[250px]"},{name:"billed_amount",label:m("MONTO FACTURADO"),field:"billed_amount",align:"left",classes:"min-w-[100px]"},{name:"discount",label:m("DESCUENTO DE AJUSTE"),field:"discount",align:"left",classes:"min-w-[100px]"},{name:"coverage",label:m("MONTO A PROCESAR"),field:"coverage",align:"left",classes:"min-w-[100px]"},{name:"deductible",label:m("DEDUCIBLE"),field:"deductible",align:"left",classes:"min-w-[100px]"},{name:"copago",label:m("COPAGO"),field:"copago",align:"left",classes:"min-w-[100px]"},{name:"covered",label:m("CUBIERTO"),field:"covered",align:"left",classes:"min-w-[100px]"},{name:"insurance_payment",label:m("PAGO DE ASEGURADA"),field:"insurance_payment",align:"left",classes:"min-w-[100px]"},{name:"insurance_responsability",label:m("RESP. ASEGURADA"),field:"insurance_responsability",align:"left",classes:"min-w-[100px]"},{name:"insurance_claim",label:m("insurance_claim"),field:"insurance_claim",align:"left",classes:"min-w-[100px]"},{name:"note",label:m("NOTA"),field:"note",align:"left",classes:"min-w-[100px]"}],rows:[]}),N=E(()=>U.rows.filter(i=>i.c_status&4));be(()=>U.rows,i=>{clearTimeout(U.timeout),U.timeout=setTimeout(()=>{$("setItems",U.rows)},300)},{deep:!0});const e=J([]),A=i=>{e.value[i]&&e.value[i].hide()};function M(i){i.quantity?i.quantity=parseInt(i.quantity)+1:i.quantity=1}function z(i){parseInt(i.quantity)>1&&(i.quantity=parseInt(i.quantity)-1)}function g(i){const _=k(i.billed_amount||0),n=k(i.discount||0);i.coverage=B(_-n)}function Q(i){const _=k(i.coverage||0),n=k(i.deductible||0);_&&n&&(i.covered=_-n)}function f(i){const _=k(i.coverage||0),n=k(i.copago||0);_&&n&&(i.covered=_-n)}async function V(i,_){try{const n=await T.get(`provider/${i}`);_.provider_id=String(n.id),_.provider_description=n.description}catch(n){console.log(n)}}function y(i){try{i.provider_id=null,i.provider_description=null}catch(_){console.log(_)}}async function L(i,_){try{const n=await T.get(`doctor/${i}`);_.doctor_id=n.id,_.doctor_description=n.description,setItinerary()}catch(n){console.log(n)}}function X(i){try{i.doctor_id=null,i.doctor_description=null,setItinerary()}catch(_){console.log(_)}}function H(i){const _=k(i.insurance_payment||0),n=k(i.deductible||0);i.insurance_responsability=_-n}async function ie(i,_){try{const n=await T.get(`CPT/${i}`);_.item_description=n.description,_.item_id=n.id,_.item_code=n.code}catch(n){console.log(n)}}async function le(i){try{if(Y.isEdit){i.c_status=1;return}i.user_id=null,i.user_description=null,i.item_id=null,i.item_description=null,i.item_code=null,i.billed_amount=null,i.discount=null,i.coverage=null,i.deductible=null,i.covered=null,i.insurance_payment=null,i.insurance_responsability=null,i.insurance_claim=null,i.note=null}catch(_){console.log(_)}}const K=()=>({c_status:4,user_id:null,user_description:null,item_description:null,quantity:1,reset:0,billed_amount:null,coverage:null,deductible:null,covered:null,insurance_payment:null,insurance_responsability:null,insurance_claim:null,note:null});function oe(){U.rows.push(K())}return re(()=>{U.rows=Y.items.concat(Array.from({length:5},()=>K()))}),(i,_)=>(u(),C("div",Ke,[l(he,{"hide-pagination":"","rows-per-page-options":[0],rows:N.value,columns:U.columns,"row-key":"id",ref_key:"tableRef",ref:F,onRequest:i.onRequest,flat:"",loading:U.loading,"wrap-cells":!0},{body:c(n=>[l(ye,{props:n},{default:c(()=>[(u(!0),C(W,null,ue(n.cols,v=>(u(),b(ve,{class:"text-xxs",key:v.name,props:n},{default:c(()=>[v.name==="date"?(u(),b(x,{key:0,dense:"",outlined:"",modelValue:n.row.book_date,"onUpdate:modelValue":o=>n.row.book_date=o,mask:"##-##-####",label:i.$t("date"),rules:[i.requiredInput],"hide-bottom-space":""},{append:c(()=>[l(ge,{name:"event",class:"cursor-pointer"},{default:c(()=>[l(xe,{ref_for:!0,ref:"popupRefs"},{default:c(()=>[l(we,{flat:"",modelValue:n.row.book_date,"onUpdate:modelValue":[o=>n.row.book_date=o,o=>A(n.rowIndex)],"no-unset":"","years-in-month-view":"",minimal:"",mask:"DD-MM-YYYY"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue","label","rules"])):v.name==="provider"?(u(),b(Ue,{key:1,onSetProvider:o=>V(o,n.row),onClearProvider:o=>y(n.row),"model-value":n.row.provider_description,id:n.row.provider_id},null,8,["onSetProvider","onClearProvider","model-value","id"])):v.name==="user_description"?(u(),b(Ie,{key:2,onSetDoctor:o=>L(o,n.row),onClearDoctor:o=>X(n.row),"model-value":n.row.doctor_description,id:n.row.doctor_id},null,8,["onSetDoctor","onClearDoctor","model-value","id"])):v.name==="item_description"?(u(),b(De,{key:3,onSetProcedure:o=>ie(o,n.row),onClearInsured:o=>le(n.row),"model-value":n.row.item_description,id:n.row.item_id},null,8,["onSetProcedure","onClearInsured","model-value","id"])):v.name==="quantity"?(u(),C("div",We,[D(l(x,{modelValue:n.row.quantity,"onUpdate:modelValue":o=>n.row.quantity=o,dense:"",outlined:"",class:"w-[50px]","data-maska":d(Ce),"data-maska-tokens":d(Ee)},null,8,["modelValue","onUpdate:modelValue","data-maska","data-maska-tokens"]),[[d(R)]]),s("div",je,[l(O,{flat:"",class:"button bg-primary-light px-2 py-0.5 h-fit mb-0.5",size:"xs",icon:"add",onClick:o=>M(n.row)},null,8,["onClick"]),l(O,{flat:"",class:"button bg-danger-light px-2 py-0.5 h-fit",size:"xs",rounded:"",icon:"remove",onClick:o=>z(n.row)},null,8,["onClick"])])])):v.name==="billed_amount"?D((u(),b(x,{key:5,readonly:!n.row.item_id,"input-class":"text-right",dense:"",outlined:"",modelValue:n.row.billed_amount,"onUpdate:modelValue":[o=>n.row.billed_amount=o,o=>g(n.row)],"data-maska":"0.99","data-maska-tokens":d(P),"hide-bottom-space":""},null,8,["readonly","modelValue","onUpdate:modelValue","data-maska-tokens"])),[[d(R),void 0,d(S)]]):v.name==="discount"?D((u(),b(x,{key:6,readonly:!n.row.item_id,"input-class":"text-right",dense:"",outlined:"",modelValue:n.row.discount,"onUpdate:modelValue":[o=>n.row.discount=o,o=>g(n.row)],"data-maska":"0.99","data-maska-tokens":d(P),"hide-bottom-space":""},null,8,["readonly","modelValue","onUpdate:modelValue","data-maska-tokens"])),[[d(R),void 0,d(S)]]):v.name==="coverage"?D((u(),b(x,{key:7,readonly:!n.row.item_id,"input-class":"text-right",dense:"",outlined:"",modelValue:n.row.coverage,"onUpdate:modelValue":[o=>n.row.coverage=o,o=>Q(n.row)],"data-maska":"0.99","data-maska-tokens":d(P),"hide-bottom-space":""},null,8,["readonly","modelValue","onUpdate:modelValue","data-maska-tokens"])),[[d(R),void 0,d(S)]]):v.name==="deductible"?D((u(),b(x,{key:8,readonly:!n.row.item_id,"input-class":"text-right",dense:"",outlined:"",modelValue:n.row.deductible,"onUpdate:modelValue":[o=>n.row.deductible=o,o=>{Q(n.row),H(n.row)}],"data-maska":"0.99","data-maska-tokens":d(P),"hide-bottom-space":""},null,8,["readonly","modelValue","onUpdate:modelValue","data-maska-tokens"])),[[d(R),void 0,d(S)]]):v.name==="copago"?D((u(),b(x,{key:9,readonly:!n.row.item_id,"input-class":"text-right",dense:"",outlined:"",modelValue:n.row.copago,"onUpdate:modelValue":[o=>n.row.copago=o,o=>{f(n.row),H(n.row)}],"data-maska":"0.99","data-maska-tokens":d(P),"hide-bottom-space":""},null,8,["readonly","modelValue","onUpdate:modelValue","data-maska-tokens"])),[[d(R),void 0,d(S)]]):v.name==="covered"?D((u(),b(x,{key:10,readonly:!n.row.item_id,"input-class":"text-right",dense:"",outlined:"",modelValue:n.row.covered,"onUpdate:modelValue":o=>n.row.covered=o,"data-maska":"0.99","data-maska-tokens":d(P),"hide-bottom-space":""},null,8,["readonly","modelValue","onUpdate:modelValue","data-maska-tokens"])),[[d(R),void 0,d(S)]]):v.name==="insurance_payment"?D((u(),b(x,{key:11,readonly:!n.row.item_id,"input-class":"text-right",dense:"",outlined:"",modelValue:n.row.insurance_payment,"onUpdate:modelValue":[o=>n.row.insurance_payment=o,o=>H(n.row)],"data-maska":"0.99","data-maska-tokens":d(P),"hide-bottom-space":""},null,8,["readonly","modelValue","onUpdate:modelValue","data-maska-tokens"])),[[d(R),void 0,d(S)]]):v.name==="insurance_responsability"?D((u(),b(x,{key:12,readonly:"","input-class":"text-right",dense:"",outlined:"",modelValue:n.row.insurance_responsability,"onUpdate:modelValue":o=>n.row.insurance_responsability=o,"data-maska":"0.99","data-maska-tokens":d(P),"hide-bottom-space":""},null,8,["modelValue","onUpdate:modelValue","data-maska-tokens"])),[[d(R),void 0,d(S)]]):v.name==="insurance_claim"?(u(),b(x,{key:13,readonly:!n.row.item_id,dense:"",outlined:"",modelValue:n.row.insurance_claim,"onUpdate:modelValue":o=>n.row.insurance_claim=o,"hide-bottom-space":""},null,8,["readonly","modelValue","onUpdate:modelValue"])):v.name==="note"?(u(),b(x,{key:14,readonly:!n.row.item_id,dense:"",outlined:"",modelValue:n.row.note,"onUpdate:modelValue":o=>n.row.note=o,"hide-bottom-space":""},null,8,["readonly","modelValue","onUpdate:modelValue"])):(u(),C(W,{key:15},[I(h(v.value),1)],64))]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"no-data":c(({icon:n,message:v,filter:o})=>[l(ke,{icon:n,message:v,filter:o},null,8,["icon","message","filter"])]),bottom:c(()=>[l(O,{flat:"",class:"button bg-primary-light w-full mt-2","no-caps":"",onClick:oe},{default:c(()=>[I("Agregar m\xE1s lineas")]),_:1})]),_:1},8,["rows","columns","onRequest","loading"])]))}},He={class:"w-full"},Je=s("div",{class:"subtitle text-xs text-center"},"Pagos",-1),Xe={__name:"ConciliationPayment",props:{items:Array,isEdit:Boolean},emits:["setItems"],setup(j,{emit:w}){const{t:m}=pe();de();const F=J();ne("$api");const T=j,Y=w,$=ae({timeout:null,timeoutRow:null,columns:[{name:"date",label:"Fecha",field:"date",align:"left",classes:"min-w-[150px]"},{name:"description",label:m("DESC."),field:"description",align:"left",classes:"min-w-[100px]"},{name:"note",label:m("NOTA"),field:"note",align:"left",classes:"min-w-[100px]"},{name:"insurance_payment",label:m("PAGO DE ASEGURADA"),field:"insurance_payment",align:"left",classes:"min-w-[100px]"},{name:"insurance_responsability",label:m("RESP. ASEGURADA"),field:"insurance_responsability",align:"left",classes:"min-w-[100px]"}],rows:[]}),U=E(()=>$.rows.filter(g=>g.c_status&4));be(()=>$.rows,g=>{clearTimeout($.timeout),$.timeout=setTimeout(()=>{Y("setItems",$.rows)},300)},{deep:!0});const N=J([]),e=g=>{N.value[g]&&N.value[g].hide()};function A(g){const Q=k(g.insurance_payment||0),f=k(g.deductible||0);g.insurance_responsability=Q-f}const M=()=>({book_date:Re(new Date,"dd-MM-yyyy"),c_status:4,quantity:1,reset:0,insurance_payment:null,insurance_responsability:null,note:null});function z(){$.rows.push(M())}return re(()=>{$.rows=T.items.concat(Array.from({length:2},()=>M()))}),(g,Q)=>(u(),C("div",He,[Je,l(he,{"hide-pagination":"","rows-per-page-options":[0],rows:U.value,columns:$.columns,"row-key":"id",ref_key:"tableRef",ref:F,onRequest:g.onRequest,flat:"",loading:$.loading,"wrap-cells":!0},{body:c(f=>[l(ye,{props:f},{default:c(()=>[(u(!0),C(W,null,ue(f.cols,V=>(u(),b(ve,{class:"text-xxs",key:V.name,props:f},{default:c(()=>[V.name==="date"?(u(),b(x,{key:0,dense:"",outlined:"",modelValue:f.row.book_date,"onUpdate:modelValue":y=>f.row.book_date=y,mask:"##-##-####",label:g.$t("date"),rules:[g.requiredInput],"hide-bottom-space":""},{append:c(()=>[l(ge,{name:"event",class:"cursor-pointer"},{default:c(()=>[l(xe,{ref_for:!0,ref:"popupRefs"},{default:c(()=>[l(we,{flat:"",modelValue:f.row.book_date,"onUpdate:modelValue":[y=>f.row.book_date=y,y=>e(f.rowIndex)],"no-unset":"","years-in-month-view":"",minimal:"",mask:"DD-MM-YYYY"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue","label","rules"])):V.name==="description"?(u(),b(x,{key:1,dense:"",outlined:"",modelValue:f.row.description,"onUpdate:modelValue":y=>f.row.description=y,"hide-bottom-space":""},null,8,["modelValue","onUpdate:modelValue"])):V.name==="note"?(u(),b(x,{key:2,dense:"",outlined:"",modelValue:f.row.note,"onUpdate:modelValue":y=>f.row.note=y,"hide-bottom-space":""},null,8,["modelValue","onUpdate:modelValue"])):V.name==="insurance_payment"?D((u(),b(x,{key:3,"input-class":"text-right",dense:"",outlined:"",modelValue:f.row.insurance_payment,"onUpdate:modelValue":[y=>f.row.insurance_payment=y,y=>A(f.row)],"data-maska":"0.99","data-maska-tokens":d(P),"hide-bottom-space":""},null,8,["modelValue","onUpdate:modelValue","data-maska-tokens"])),[[d(R),void 0,d(S)]]):V.name==="insurance_responsability"?D((u(),b(x,{key:4,"input-class":"text-right",dense:"",outlined:"",modelValue:f.row.insurance_responsability,"onUpdate:modelValue":y=>f.row.insurance_responsability=y,"data-maska":"0.99","data-maska-tokens":d(P),"hide-bottom-space":""},null,8,["modelValue","onUpdate:modelValue","data-maska-tokens"])),[[d(R),void 0,d(S)]]):(u(),C(W,{key:5},[I(h(V.value),1)],64))]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"no-data":c(({icon:f,message:V,filter:y})=>[l(ke,{icon:f,message:V,filter:y},null,8,["icon","message","filter"])]),bottom:c(()=>[l(O,{flat:"",class:"button bg-primary-light w-full mt-2","no-caps":"",onClick:z},{default:c(()=>[I("Agregar m\xE1s lineas")]),_:1})]),_:1},8,["rows","columns","onRequest","loading"])]))}},Ze={class:"flex md:flex-nowrap justify-between mb-2"},et={class:"w-[300px] min-w-[300px]"},tt={key:0,class:"flex flex-col"},nt={class:"text-xs"},at={class:"flex items-center"},it={class:"text-xs"},lt=s("span",null,"\xA0-\xA0",-1),ot={class:"text-xs"},st=s("span",null,"\xA0-\xA0",-1),dt={class:"text-xs"},rt={class:"grid lg:grid-cols-4 grid-cols-2 gap-2 w-[600px]"},ut={class:"flex flex-nowrap w-full"},ct={class:"flex flex-col w-full"},mt={class:"text-font text-right text-md"},_t={class:"flex flex-col"},ft={class:"text-font text-right text-md"},pt={class:"flex flex-col"},bt={class:"text-font text-right text-md"},yt={class:"flex flex-col"},vt={class:"text-font text-right text-md"},gt={class:"flex flex-col"},xt={class:"text-font text-right text-md"},wt={class:"flex flex-col"},kt={class:"text-font text-right text-md"},ht={class:"flex flex-col"},Vt={class:"text-font text-right text-md"},$t={class:"flex flex-col"},Ut={class:"text-font text-right text-md"},It={class:"flex flex-nowrap w-full"},Dt={class:"grid grid-cols-6 gap-2"},Ct={class:"col-span-5 flex md:flex-nowrap gap-2"},Et={class:"w-full"},Rt={key:0,class:"mt-2"},At={class:"flex flex-col gap-1 mb-1"},Pt=s("div",{class:"subtitle text-xs text-center"},"Moneda",-1),St=s("div",{class:"subtitle text-xs text-center"},"\xC1rea",-1),Tt={class:"flex flex-col gap-1"},qt=s("div",{class:"subtitle text-center text-xs"},"Diagn\xF3sticos",-1),Ot={class:"w-full flex flex-col justify-between border card shadow-none px-3 py-1"},Qt={class:"text-xs uppercase line-clamp-1"},Bt={class:"text-xs uppercase line-clamp-1"},Mt={class:"fixed bottom-0 right-0 py-2 bg-white w-full"},Gt={class:"flex flex-nowrap gap-2 px-2 mt-1"},Yt={__name:"conciliation-write",props:{id:Number,eventId:String,width:String,isDrawer:Boolean},setup(j){const w=j,m=ne("$api"),F=ne("$cats"),T=de(),Y=Ae(),$=J(),U=ae({currency:F.value.currency,policy_branch:F.value.policy_branch}),N=()=>({diagnosis:[],$book_state_id:50,$currency_id:14,book_date:Fe(new Date)}),e=ae({payments:[],submitting:!1,loading:!0,event:{},items:[],item:N()}),A=E(()=>Boolean(w.id)),M=E(()=>{const a=e.items.reduce((t,r)=>(r.c_status&1||(t+=k(r.coverage)||0),t),0);return B(a)}),z=E(()=>{const a=e.items.reduce((t,r)=>(r.c_status&1||(t+=k(r.discount)||0),t),0);return B(a)}),g=E(()=>{const a=e.items.reduce((t,r)=>(r.c_status&1||(t+=k(r.billed_amount)||0),t),0);return B(a)}),Q=E(()=>{const a=e.items.reduce((t,r)=>(r.c_status&1||(t+=k(r.deductible)||0),t),0);return B(a)}),f=E(()=>{const a=e.items.reduce((t,r)=>(r.c_status&1||(t+=k(r.copago)||0),t),0);return B(a)}),V=E(()=>{const a=e.items.reduce((t,r)=>(r.c_status&1||(t+=k(r.covered)||0),t),0);return B(a)}),y=E(()=>{const a=e.items.reduce((t,r)=>(r.c_status&1||(t+=k(r.insurance_payment)||0),t),0);return B(a)}),L=E(()=>{const a=e.items.reduce((t,r)=>(r.c_status&1||(t+=k(r.insurance_responsability)||0),t),0);return B(a)});async function X(a){try{if(!a)return;const t=await m.get(`insured/${a}`);if(!w.isEdit&&t.policies){const r=t.policies[0];K(r)}e.item.insured_id=t.id,e.item.insured_description=t.fullname}catch(t){console.log(t)}}function H(){e.item.insured_id=null,e.item.insured=null,oe()}async function ie(a){try{if(!a)return;const t=await m.get(`insured/${a}`);e.item.titular_id=t.id,e.item.titular_description=t.fullname}catch(t){console.log(t)}}function le(){e.item.titular_id=null,e.item.titular=null}async function K(a){e.item.insured_id||(e.item.insured_id=a.insured_id,e.item.insured_description=a.insured_description),e.item.insurance_id=a.insurance_id,e.item.insurance_description=a.insurance,e.item.titular_id=a.titular_id,e.item.titular_description=a.titular_description,e.item.insured_code=a.insured_code,e.item.deductible=a.deductible,e.item.policy_id=a.id,e.item.policy_number=a.policy_number,e.item.policy_branch=a.policy_branch,e.item.$policy_branch_id=a.$policy_branch_id}async function oe(){e.item.insurance_id=null,e.item.insurance_description=null,e.item.titular_id=null,e.item.titular_description=null,e.item.insured_code=null,e.item.policy_id=null,e.item.policy_number=null,e.item.deductible=null}async function i(a){try{const t=await m.get(`ICD10/${a}`);if(e.item.diagnosis.findIndex(q=>q.id===a)!==-1){T.notify({type:"warning",message:"Diagn\xF3stico ya esta agregado"});return}e.item.diagnosis.push({id:t.id,code:t.code,description:t.description}),e.item.diagnosis_description=null,e.item.diagnosis_id=null}catch(t){console.log(t)}}function _(){try{e.item.diagnosis_id=null,e.item.diagnosis_description=null}catch(a){console.log(a)}}function n(a){try{const t=e.item.diagnosis.findIndex(r=>r.id===a);e.item.diagnosis.splice(t,1)}catch(t){console.log(t)}}function v(){e.item=N(),setTimeout(()=>{$.value.resetValidation()}),Z()}async function o(){e.submitting=!0;const a=await m.get(`conciliation/pdf/${w.id}`);console.log(11,a),Ye(a,`${e.item.code}-${e.item.insurance_description}`.toUpperCase()),e.submitting=!1}async function Ve(){try{if(A.value){const a=e.items.filter(r=>r.item_id);if(!a.length){T.notify({type:"success",message:"Es requerido que la reconcilici\xF3n tenga por lo menos 1 CPT"});return}const t=await m.put(`conciliation/${w.id}`,{book:{...e.item,billed_amount_total:g.value,coverage_total:M.value,discount_total:z.value,deductible_total:Q.value,copago_total:f.value,covered_total:V.value,insurance_payment_total:y.value,insurance_responsability_total:L.value},book_items:a,book_payments:e.payments});t&&(T.notify({type:"success",message:`Reconciliaci\xF3n Editada ${t.code}`}),location.reload(),Z())}else{const a=await m.post("conciliation",{book:{...e.item,billed_amount_total:g.value,coverage_total:M.value,discount_total:z.value,deductible_total:Q.value,copago_total:f.value,covered_total:V.value,insurance_payment_total:y.value,insurance_responsability_total:L.value},book_items:e.items.filter(t=>t.c_status===4&&t.item_id),book_payments:e.payments.filter(t=>t.c_status===4)});w.eventId&&m.put(`event/general/${w.eventId}`,{book_code:a.code}),a&&(T.notify({type:"success",message:`Reconciliaci\xF3n agregada ${a.code}`}),await m.get(`conciliation/pdf/${a.code}`),v(),Y.push("/"),Z())}}catch(a){console.log(a)}}async function Z(){try{if(A.value){const{item:a,items:t,payments:r}=await m.get(`conciliation/${w.id}`);e.item=a,e.items=t,e.payments=r,e.item.event_id&&(e.event=await m.get(`event/${e.item.event_id}`)),e.loading=!1;return}if(w.eventId){e.event=await m.get(`event/${w.eventId}`),e.policy=await m.get(`policy/insured/${e.event.policy_id}`),e.item.event_id=e.event.id,K(e.policy),e.item.diagnosis=e.event.diagnosis,e.itineraries=await m.get("itinerary",{params:{where:{c_status:4,event_id:w.eventId},returnItems:!0}});for(let a=0;a<e.itineraries.length;a++){const t=e.itineraries[a];for(let r=0;r<t.mprocedure.length;r++){const q=t.mprocedure[r];e.items.push({c_status:4,book_date:t.attendance_date,item_id:q.id,item_description:q.description,provider_id:t.provider_id,provider_description:t.provider_description,quantity:1,reset:0,billed_amount:null,coverage:null,deductible:null,covered:null,insurance_payment:null,insurance_responsability:null,insurance_claim:null,note:null})}}await X(e.event.insured_id),e.item.user_id=e.event.user_id,e.item.user_description=e.event.user_description}e.loading=!1}catch(a){console.log(a)}}re(()=>{Z()});const $e=E(()=>({width:w.width,"padding-right":w.isDrawer&&"8px","padding-left":w.isDrawer&&"8px"}));return(a,t)=>{const r=Pe("loading");return e.loading?ee("",!0):(u(),C("div",{key:0,style:ze($e.value),class:"relative pb-32 px-4"},[l(Be,{ref_key:"mainForm",ref:$,onSubmit:Ve},{default:c(()=>{var q;return[s("div",Ze,[s("div",et,[(q=e.event)!=null&&q.id?(u(),C("div",tt,[s("span",nt,h(e.event.contact_description),1),s("div",at,[s("span",it,"#"+h(e.event.code),1),lt,s("span",ot,h(e.event.event_type),1),st,s("span",dt,h(e.event.event_state),1)]),l(O,{flat:"",class:"button bg-btn-green rounded-md w-full",label:"Abrir Coordinaci\xF3n","no-caps":"",onClick:t[0]||(t[0]=p=>{e.dialogWriteEvent=!0})})])):ee("",!0)]),s("div",rt,[s("div",ut,[s("div",ct,[l(G,{class:"text-xxs text-font bg-stone-200 rounded"},{default:c(()=>[I("Total Reconciliaci\xF3n")]),_:1}),s("span",mt,h(a.$currency(g.value)),1)])]),s("div",_t,[l(G,{class:"text-xxs text-font bg-stone-200 rounded"},{default:c(()=>[I("Descuento de Ajuste")]),_:1}),s("span",ft,h(a.$currency(z.value)),1)]),s("div",pt,[l(G,{class:"text-xxs text-font bg-stone-200 rounded"},{default:c(()=>[I("Monto a Procesar")]),_:1}),s("span",bt,h(a.$currency(M.value)),1)]),s("div",yt,[l(G,{class:"text-xxs text-font bg-stone-200 rounded"},{default:c(()=>[I("DEDUCIBLE")]),_:1}),s("span",vt,h(a.$currency(Q.value)),1)]),s("div",gt,[l(G,{class:"text-xxs text-font bg-stone-200 rounded"},{default:c(()=>[I("COPAGO")]),_:1}),s("span",xt,h(a.$currency(f.value)),1)]),s("div",wt,[l(G,{class:"text-xxs text-font bg-stone-200 rounded"},{default:c(()=>[I("CUBIERTO")]),_:1}),s("span",kt,h(a.$currency(V.value)),1)]),s("div",ht,[l(G,{class:"text-xxs text-font bg-stone-200 rounded"},{default:c(()=>[I("PAGO DE ASEGURADA")]),_:1}),s("span",Vt,h(a.$currency(y.value)),1)]),s("div",$t,[l(G,{class:"text-xxs text-font bg-stone-200 rounded"},{default:c(()=>[I("RESP. ASEGURADA")]),_:1}),s("span",Ut,h(a.$currency(L.value)),1)]),s("div",It,[A.value?D((u(),b(O,{key:0,flat:"",class:"button-press bg-btn-red rounded-md w-full",label:"Imprimir","no-caps":"",onClick:o},null,512)),[[r,e.submitting]]):ee("",!0)])])]),s("div",Dt,[s("div",Ct,[s("div",Et,[l(Le,{items:e.items,isEdit:A.value,onSetItems:t[1]||(t[1]=p=>e.items=p)},null,8,["items","isEdit"]),l(Xe,{class:"pt-2",items:e.payments,isEdit:A.value,onSetItems:t[2]||(t[2]=p=>e.payments=p)},null,8,["items","isEdit"]),A.value?(u(),C("div",Rt,[l(Se,{ref_id:e.item.id,table:"t_book",file_type:"GENERAL"},null,8,["ref_id"]),l(Te,{refId:e.item.id,refKey:"t_book"},null,8,["refId"])])):ee("",!0)])]),s("div",At,[l(ce,{ref:"mainInput",onSetInsured:X,onSetPolicy:K,onClearInsured:H,"model-value":e.item.insured_description,id:e.item.insured_id,rules:[d(te)]},null,8,["model-value","id","rules"]),l(ce,{readonly:"",ref:"mainInput",onSetInsured:ie,onClearInsured:le,"model-value":e.item.titular_description,id:e.item.titular_id,label:"Titular",rules:[d(te)]},null,8,["model-value","id","rules"]),l(qe,{onSetInsurance:t[3]||(t[3]=p=>a.setInsurance(p,a.row)),onClearInsurance:t[4]||(t[4]=p=>a.clearInsurance(a.row)),"model-value":e.item.insurance_description,rules:[d(te)],"hide-bottom-space":""},null,8,["model-value","rules"]),l(x,{readonly:"",dense:"",outlined:"",modelValue:e.item.policy_number,"onUpdate:modelValue":t[5]||(t[5]=p=>e.item.policy_number=p),label:a.$t("policy_number"),onKeydown:t[6]||(t[6]=me(se(()=>{},["prevent"]),["enter"])),rules:[d(te)],"hide-bottom-space":""},null,8,["modelValue","label","rules"]),l(x,{readonly:"",dense:"",outlined:"",modelValue:e.item.insured_code,"onUpdate:modelValue":[t[7]||(t[7]=p=>e.item.insured_code=p),a.findInsuredCode],label:a.$t("insured_code"),onKeydown:t[8]||(t[8]=me(se(()=>{},["prevent"]),["enter"])),"hide-bottom-space":""},null,8,["modelValue","label","onUpdate:modelValue"]),D(l(x,{"input-class":"text-right",dense:"",outlined:"",modelValue:e.item.deductible,"onUpdate:modelValue":t[9]||(t[9]=p=>e.item.deductible=p),label:"Deducible","data-maska":"0.99","data-maska-tokens":d(P),"hide-bottom-space":""},null,8,["modelValue","data-maska-tokens"]),[[d(R),void 0,d(S)]]),s("div",null,[Pt,l(_e,{class:"flex gap-1 text-xs",size:"sm",modelValue:e.item.$currency_id,"onUpdate:modelValue":t[10]||(t[10]=p=>e.item.$currency_id=p),"toggle-color":"secondary","toggle-text-color":"text-font",options:U.currency},null,8,["modelValue","options"])]),s("div",null,[St,l(_e,{class:"flex gap-1 text-xs",size:"sm",modelValue:e.item.$policy_branch_id,"onUpdate:modelValue":t[11]||(t[11]=p=>e.item.$policy_branch_id=p),"toggle-color":"secondary","toggle-text-color":"text-font",options:U.policy_branch},null,8,["modelValue","options"])]),s("div",Tt,[qt,l(Oe,{onSetDiagnosis:i,onClearInsured:_,"model-value":e.item.diagnosis_description},null,8,["model-value"]),(u(!0),C(W,null,ue(e.item.diagnosis,(p,Nt)=>(u(),C("div",{class:"flex flex-nowrap gap-1",key:p.id},[s("div",Ot,[s("div",Qt,h(p.description),1),s("div",Bt,h(p.code),1)]),l(O,{diabled:"",flat:"",class:"button-icon bg-primary text-white text-[10px] h-[40px]",icon:"fa-solid fa-xmark",onClick:zt=>n(p.id)},{default:c(()=>[l(fe,{class:"bg-default text-black text-xs"},{default:c(()=>[I("Remover diagn\xF3stico")]),_:1})]),_:2},1032,["onClick"])]))),128))])])]),s("div",Mt,[l(Qe,{item:e.item,isEdit:A.value},null,8,["item","isEdit"]),s("div",Gt,[w.isEdit?(u(),C(W,{key:0},[l(O,{class:"button-icon bg-primary text-white py-0",icon:"fa-solid fa-xmark",rounded:"",onClick:t[12]||(t[12]=se(p=>a.onDelete(e.item.id),["stop"])),size:"sm"},{default:c(()=>[l(fe,{class:"bg-default text-black",size:"xs"},{default:c(()=>[I("Remover")]),_:1})]),_:1}),l(O,{class:"button-press w-full text-lg rounded-md bg-primary text-white",flat:"",label:"guardar cambios",type:"submit"})],64)):(u(),b(O,{key:1,class:"button-press w-full text-lg rounded-md bg-primary text-white",flat:"",label:"guardar cambios",type:"submit"}))])])]}),_:1},512),l(Ne,{modelValue:e.dialogWriteEvent,"onUpdate:modelValue":t[14]||(t[14]=q=>e.dialogWriteEvent=q),position:a.$isDesktop?"right":"standard","full-height":"",maximized:"","transition-duration":100},{default:c(()=>[l(Me,null,{default:c(()=>[l(Ge,{onClose:t[13]||(t[13]=q=>e.dialogWriteEvent=!1),isDrawer:"",id:e.event.id,isEdit:"",width:(a.$isDesktop,"100%")},null,8,["id","width"])]),_:1})]),_:1},8,["modelValue","position"])],4))}}};export{Yt as default};
