import{r as G,l as C,m as K,n as Q,w as E,o as ee,q as O,k as B,t as g,v as b,x as n,y as s,z as l,Q as H,A as I,F as c,B as f,E as w,G as W,D as z,H as u,I as J,J as X,K as Y,L as S,M as U,O as le,R as L,S as T,az as te,aE as se,_ as ae,aF as A,aC as j,C as ie,aG as F,aH as ne,aI as oe,$ as de,U as M,V as re,a9 as ue,aa as R,aD as ce,a7 as pe,ac as fe,af as me}from"./index.d13f88fb.js";import{_ as ge}from"./insuredCard.d76746cd.js";const _e={class:"flex justify-between md:flex-nowrap mb-1"},be={class:"flex flex-nowrap w-full gap-2"},ye={class:"flex justify-end"},we={key:0,class:"grid grid-flow-col auto-cols-max gap-2"},ve={class:"full-width row flex-center text-primary q-gutter-sm"},xe={__name:"InsuranceInsuredTable",props:{insuredId:Number,insuredId:Number,insurance_id:Number},setup(v){var P;const m=v,r=G(),x=C("$me"),o=C("$api"),y=K(),e=Q({timePeriod:"today",dialogWrite:!1,dialogList:!1,dialogCreate:!1,selectedId:0,dialogWidth:400,selected:[],search:"",search_key:"orlike:code,ident_no,fullname",pagination:{sortBy:"code",descending:!1,page:1,rowsPerPage:20},url:"insured",query:{groupBy:["t_insured.code"],where:{c_status:4,insured_id:(P=m.insuredId)!=null?P:null,["js:policies|insurance_id"]:[m.insurance_id]}},columns:[],rows:[]}),$=async function(){try{if(!(x.unixroles&1)){y.notify({type:"danger",message:"No tienes acceso para unir expedientes"});return}const p=e.selected[0].fullname,d=[...e.selected].splice(1,e.selected.length).map(i=>i.fullname);(await y.dialog({title:"Confirmar Eliminaci\xF3n de Duplicados",message:`Desea unir: ${p} -> ${d.join(", ")}`,cancel:!0,persistent:!0})).onOk(async()=>{await o.post(`${e.url}/merge`,{data:e.selected.map(i=>i.id)}),y.notify({type:"success",message:"Duplicados removidos"})})}catch(p){console.log(p)}};E(()=>e.timePeriod,p=>{ee(p,e.query,"insured_date")});const{onRequest:h,getSelectedString:_,onDeleteRows:V,addMore:N,itemsRange:q}=O(e,r),D=B();return E(()=>D.table.t_insured,p=>{r.value.requestServerInteraction(),r.value.clearSelection()},{deep:!0}),(p,d)=>(g(),b(T,{class:L(v.insuredId?"px-2 py-3":"px-1.5 py-2 lg:px-5 lg:py-6")},{default:n(()=>[s("div",_e,[s("div",be,[l(H,{class:"w-full md:w-auto",dense:"",outlined:"",debounce:"300",modelValue:e.search,"onUpdate:modelValue":d[0]||(d[0]=a=>e.search=a),placeholder:p.$t("search")},{append:n(()=>[l(I,{name:"search"})]),_:1},8,["modelValue","placeholder"]),e.selected.length?(g(),b(c,{key:0,flat:"",class:"button h-full bg-primary text-white","icon-right":"sym_o_remove",label:p.$isDesktop?"Remover":"","no-caps":"",onClick:f(V)},null,8,["label","onClick"])):w("",!0),f(x).unixroles&1&&e.selected.length>1?(g(),b(c,{key:1,flat:"",class:"button h-full bg-orange-300","icon-right":"sym_o_cell_merge",label:p.$isDesktop?"Unir":"","no-caps":"",onClick:$},null,8,["label"])):w("",!0)]),s("div",ye,[p.$isDesktop?(g(),W("div",we,[l(c,{class:"bg-transparent",flat:"","no-caps":""},{default:n(()=>[z(u(f(q).start)+" - "+u(f(q).end)+" de "+u(e.pagination.rowsNumber),1)]),_:1}),l(c,{class:"bg-transparent",icon:"sym_o_first_page",flat:"",onClick:d[1]||(d[1]=a=>r.value.firstPage())}),l(c,{class:"bg-transparent",icon:"sym_o_navigate_before",flat:"",onClick:d[2]||(d[2]=a=>r.value.prevPage())}),l(c,{class:"bg-transparent",icon:"sym_o_navigate_next",flat:"",onClick:d[3]||(d[3]=a=>r.value.nextPage())}),l(c,{class:"bg-transparent",icon:"sym_o_last_page",flat:"",onClick:d[4]||(d[4]=a=>r.value.lastPage())})])):w("",!0)])]),l(J,{"table-class":"table-style-1",grid:"","hide-pagination":"",rows:e.rows,columns:e.columns,"row-key":"id",ref_key:"tableRef",ref:r,onRequest:f(h),flat:"",selection:"multiple",pagination:e.pagination,"onUpdate:pagination":d[6]||(d[6]=a=>e.pagination=a),selected:e.selected,"onUpdate:selected":d[7]||(d[7]=a=>e.selected=a),"selected-rows-label":f(_),loading:e.loading,"rows-per-page-label":"Lineas","rows-per-page-options":[10,20,50,100],"wrap-cells":!0},X({"no-data":n(({icon:a,message:i,filter:t})=>[s("div",ve,[s("span",null,u(i),1),l(I,{size:"2em",name:t?"filter_b_and_w":a},null,8,["name"])])]),item:n(a=>[s("div",{class:"q-pa-xs col-lg-4 col-md-6 col-xs-12",style:Y(a.selected?"transform: scale(0.95);":"")},[l(ge,{item:a,onSelectedId:d[5]||(d[5]=i=>{e.selectedId=i,e.dialogWrite=!0})},null,8,["item"])],4)]),_:2},[p.$isDesktop?void 0:{name:"bottom",fn:n(()=>[l(c,{flat:"",class:"button bg-primary-light w-full","no-caps":"",onClick:f(N)},{default:n(()=>[z("Cargar m\xE1s")]),_:1},8,["onClick"])]),key:"0"}]),1032,["rows","columns","onRequest","pagination","selected","selected-rows-label","loading"]),l(S,{class:"q-pa-none left-0","no-refocus":"",modelValue:e.dialogWrite,"onUpdate:modelValue":d[9]||(d[9]=a=>e.dialogWrite=a),position:p.$isDesktop?"right":"standard","full-height":"",maximized:"","transition-duration":p.$isDesktop?100:0},{default:n(()=>[l(U,null,{default:n(()=>[l(le,{onClose:d[8]||(d[8]=a=>{e.dialogWrite=!1}),isEdit:"",isDrawer:"",id:e.selectedId,width:p.$isDesktop?"1000px":"100%"},null,8,["id","width"])]),_:1})]),_:1},8,["modelValue","position","transition-duration"])]),_:1},8,["class"]))}},$e={class:"flex justify-between md:flex-nowrap mb-2"},he={class:"flex flex-nowrap w-full gap-2"},ke={key:0,class:"grid grid-flow-col auto-cols-max gap-2"},Ce={class:"flex flex-nowrap w-full gap-2"},Ie={class:"grid grid-cols-2 gap-1"},Ve={class:"bg-stone-100 text-center text-xs"},qe={class:"bg-stone-100 text-center text-xs"},De={class:"full-width row flex-center text-primary q-gutter-sm"},Pe={class:"flex gap-2"},Re={class:"line-clamp-1"},Se={class:"line-clamp-1"},Ue={bordered:"",flat:"",class:"card pb-2 relative flex flex-nowrap"},Qe={class:"absolute right-3 top-2"},Ee={class:"pl-3 pr-8 w-full pt-2 flex flex-col overflow-hidden"},We={class:"text-uppercase line-clamp-1 font-semibold"},ze={class:"text-uppercase line-clamp-1 text-xxs"},Ne={class:"flex justify-end gap-2 -mr-5 mt-1"},je={__name:"InsurancePolicyTable",props:{insuredId:Number,insurance_id:Number},setup(v){var p,d;const{t:m}=te(),r=G(),x=v,o=C("$cats"),y=Q({policy_branch:o.value.policy_branch}),e=Q({dialogImport:!1,dialogWrite:!1,dialogList:!1,dialogCreate:!1,selectedId:0,dialogWidth:400,selected:[],search:"",search_key:"orlike:insured_description,insurance,policy_number",pagination:{sortBy:"created",descending:!0,page:1,rowsPerPage:20},url:"policy",query:{groupBy:["t_policy.id"],where:{"in:$policy_type_id":[],"in:$policy_branch_id":[],insured_id:(p=x.insuredId)!=null?p:null,insurance_id:(d=x.insurance_id)!=null?d:null,c_status:4}},columns:[{name:"action",required:!0,label:"",align:"left",field:m("id"),classes:"w-[220px]"},{name:"customer_description",required:!0,label:m("customer_description"),align:"left",field:"customer_description",sortable:!0,classes:"w-[200px]"},{name:"titular_description",required:!0,label:m("titular"),align:"left",field:"titular_description",sortable:!0,classes:"w-[200px]"},{name:"policy_number",required:!0,label:m("policy_number"),align:"left",field:"policy_number",sortable:!0},{name:"insurance",required:!0,label:m("insurance"),align:"left",field:"insurance",sortable:!0},{name:"policy_branch",required:!0,label:m("policy_branch"),align:"left",field:"policy_branch",sortable:!0},{name:"policy_type",required:!0,label:m("policy_type"),align:"left",field:"policy_type",sortable:!0},{name:"validity_date_end",required:!0,label:m("validity_date_end"),align:"left",field:"validity_date_end",sortable:!0}],rows:[]});function $(a){try{e.query.where.insurance_id=a}catch(i){console.log(i)}}function h(){try{e.query.where.insurance_id=null}catch(a){console.log(a)}}const{onRequest:_,getSelectedString:V,onDeleteRows:N,addMore:q,itemsRange:D}=O(e,r);se(y);const P=B();return E(()=>P.table.t_policy,a=>{r.value.requestServerInteraction(),r.value.clearSelection()},{deep:!0}),(a,i)=>(g(),b(T,{class:L(v.insuredId?"px-2 py-3":"px-1.5 py-2 lg:px-5 lg:py-6")},{default:n(()=>[s("div",$e,[s("div",he,[l(H,{class:"w-full md:w-auto",dense:"",outlined:"",debounce:"300",modelValue:e.search,"onUpdate:modelValue":i[0]||(i[0]=t=>e.search=t),placeholder:a.$t("search")},{append:n(()=>[l(I,{name:"search"})]),_:1},8,["modelValue","placeholder"]),e.selected.length?(g(),b(c,{key:0,flat:"",class:"button h-full bg-primary text-white","icon-right":"sym_o_remove",label:a.$isDesktop?"Remover":"","no-caps":"",onClick:f(N)},null,8,["label","onClick"])):w("",!0)]),a.$isDesktop?(g(),W("div",ke,[l(c,{class:"bg-transparent",flat:"","no-caps":""},{default:n(()=>[z(u(f(D).start)+" - "+u(f(D).end)+" de "+u(e.pagination.rowsNumber),1)]),_:1}),l(c,{class:"bg-transparent",icon:"sym_o_first_page",flat:"",onClick:i[1]||(i[1]=t=>r.value.firstPage())}),l(c,{class:"bg-transparent",icon:"sym_o_navigate_before",flat:"",onClick:i[2]||(i[2]=t=>r.value.prevPage())}),l(c,{class:"bg-transparent",icon:"sym_o_navigate_next",flat:"",onClick:i[3]||(i[3]=t=>r.value.nextPage())}),l(c,{class:"bg-transparent",icon:"sym_o_last_page",flat:"",onClick:i[4]||(i[4]=t=>r.value.lastPage())})])):w("",!0)]),s("div",Ce,[l(ae,{class:"mb-2",onSetInsurance:$,onClearInsurance:h,"model-value":e.query.where.insurance},null,8,["model-value"]),s("div",Ie,[s("div",null,[s("div",Ve,u(a.$t("policy_type")),1),l(A,{class:"flex gap-1 text-xs",size:"xs",modelValue:e.query.where["in:$policy_type_id"],"onUpdate:modelValue":i[5]||(i[5]=t=>e.query.where["in:$policy_type_id"]=t),"toggle-color":"secondary","toggle-text-color":"text-font",options:f(o).policy_type,type:"checkbox"},null,8,["modelValue","options"])]),s("div",null,[s("div",qe,u(a.$t("policy_branch")),1),l(A,{class:"flex gap-1 text-xs",size:"xs",modelValue:e.query.where["in:$policy_branch_id"],"onUpdate:modelValue":i[6]||(i[6]=t=>e.query.where["in:$policy_branch_id"]=t),"toggle-color":"secondary","toggle-text-color":"text-font",options:f(o).policy_branch,type:"checkbox"},null,8,["modelValue","options"])])])]),l(J,{grid:!a.$isDesktop,"hide-pagination":"",rows:e.rows,columns:e.columns,"row-key":"id",ref_key:"tableRef",ref:r,onRequest:f(_),flat:"",selection:"multiple",pagination:e.pagination,"onUpdate:pagination":i[7]||(i[7]=t=>e.pagination=t),selected:e.selected,"onUpdate:selected":i[8]||(i[8]=t=>e.selected=t),"selected-rows-label":f(V),loading:e.loading,"rows-per-page-label":"Lineas","wrap-cells":!0},X({"no-data":n(({icon:t,message:k,filter:Z})=>[s("div",De,[s("span",null,u(k),1),l(I,{size:"2em",name:Z?"filter_b_and_w":t},null,8,["name"])])]),"body-cell-action":n(t=>[l(j,{props:t},{default:n(()=>[s("div",Pe,[l(c,{flat:"",class:"button bg-default text-primary rounded-md",label:"Editar","no-caps":"",onClick:k=>{e.selectedId=t.row.id,e.dialogWrite=!0}},null,8,["onClick"]),l(c,{flat:"",class:"button bg-default text-primary rounded-md",label:"consultar","no-caps":"",onClick:k=>a.$router.push(`${a.$path.policy}/${a.$path.policy_consult}/${t.row.id}`)},null,8,["onClick"])])]),_:2},1032,["props"])]),"body-cell-customer_description":n(t=>[l(j,{props:t},{default:n(()=>[s("span",Re,u(t.row.customer_description),1)]),_:2},1032,["props"])]),"body-cell-deductible":n(t=>[l(j,{props:t},{default:n(()=>[s("span",Se,u(a.$currency(t.row.deductible)),1)]),_:2},1032,["props"])]),item:n(t=>[s("div",{class:"q-py-xs col-xs-12 col-sm-6 col-md-4",style:Y(t.selected?"transform: scale(0.95);":"")},[s("div",Ue,[s("div",Qe,[l(ie,{dense:"",modelValue:t.selected,"onUpdate:modelValue":k=>t.selected=k,label:t.row.name},null,8,["modelValue","onUpdate:modelValue","label"])]),s("div",Ee,[s("span",We,u(t.row.description),1),s("span",ze,u(t.row.ref),1),s("div",Ne,[l(c,{flat:"",class:"button bg-default text-primary rounded-md",size:"sm",label:"Editar","no-caps":"",onClick:k=>{e.selectedId=t.row.id,e.dialogWrite=!0}},null,8,["onClick"])])])])],4)]),_:2},[a.$isDesktop?void 0:{name:"bottom",fn:n(()=>[l(c,{flat:"",class:"button bg-primary-light w-full","no-caps":"",onClick:f(q)},{default:n(()=>[z("Cargar m\xE1s")]),_:1},8,["onClick"])]),key:"0"}]),1032,["grid","rows","columns","onRequest","pagination","selected","selected-rows-label","loading"]),l(S,{class:"q-pa-none",modelValue:e.dialogWrite,"onUpdate:modelValue":i[10]||(i[10]=t=>e.dialogWrite=t),position:a.$isDesktop?"right":"standard","full-height":"","full-width":a.$isDesktop,maximized:"","transition-duration":100},{default:n(()=>[l(U,null,{default:n(()=>[l(F,{onClose:i[9]||(i[9]=t=>e.dialogWrite=!1),isDrawer:"",id:e.selectedId,isEdit:"",width:a.$isDesktop?"400px":"100%"},null,8,["id","width"])]),_:1})]),_:1},8,["modelValue","position","full-width"]),l(S,{modelValue:e.dialogCreate,"onUpdate:modelValue":i[12]||(i[12]=t=>e.dialogCreate=t),position:a.$isDesktop?"right":"standard","full-height":"",maximized:"","transition-duration":100},{default:n(()=>[l(U,null,{default:n(()=>[l(F,{onClose:i[11]||(i[11]=t=>e.dialogCreate=!1),isDrawer:"",width:a.$isDesktop?"400px":"100%"},null,8,["width"])]),_:1})]),_:1},8,["modelValue","position"]),l(S,{modelValue:e.dialogImport,"onUpdate:modelValue":i[14]||(i[14]=t=>e.dialogImport=t),"full-height":"","full-width":"","transition-duration":100},{default:n(()=>[l(U,null,{default:n(()=>[l(ne,{table:"t_policy",onClose:i[13]||(i[13]=t=>e.dialogImport=!1)})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["class"]))}},Be={class:"flex md:flex-nowrap gap-2 break-all"},Le={class:"w-full md:max-w-[200px] min-w-[200px]"},Te={class:"card rounded-md flex flex-col py-2 px-3 mb-1"},Ae={class:"font-semibold text-xs"},Fe={class:"flex justify-between gap-2"},Me={class:"flex justify-between gap-2"},Ge={class:"grid gap-1 my-1"},Ke={class:"flex items-center justify-between w-full"},Oe={class:"flex items-center w-full"},He={class:"ml-4 md:text-md font-bold pt-1.5"},Je={class:"w-full"},Xe={class:"card px-3 py-2"},Ye={class:"flex flex-col w-full md:max-w-[250px] min-w-[250px]"},ll=oe({__name:"insurance-view",props:{id:String},setup(v){K();const m=C("$api"),r=C("$me"),x=v,o=Q({loading:!0,timeout:null,tabsList:[{label:"Seguimiento",value:"history",icon:"list"},{label:"Prescripciones",value:"prescription",icon:"list"}],tabs:[{label:"Editar Asegurado",value:"edit",icon:"fa-duotone fa-solid fa-user-pen",visible:1},{label:"Archivos",value:"file",icon:"fa-duotone fa-solid fa-image",visible:1},{label:"Asegurados",value:"insured",icon:"fa-duotone fa-solid fa-hospital-user",visible:(r.unixroles&265,1)},{label:"P\xF3lizas",value:"policy",icon:"fa-duotone fa-solid fa-heart-circle-plus",visible:(r.unixroles&265,1)},{label:"Coodinaciones",value:"event",icon:"fa-duotone fa-solid fa-calendar",visible:(r.unixroles&265,1)},{label:"Liquidaciones",value:"settlement",icon:"fa-duotone fa-solid fa-file-lines",visible:(r.unixroles&265,1)},{label:"Reembolsos",value:"refund",icon:"fa-duotone fa-solid fa-file-lines",visible:(r.unixroles&265,1)}],tab:"edit",tabList:"history",item:{},dialogWrite:!1,dialogPassword:!1});async function y(){o.item=await m.get(`insurance/${x.id}`),o.loading=!1}const e=B();return E(()=>e.table.t_insurance,$=>{$.id===o.item.id&&y()},{deep:!0}),de(()=>{y()}),($,h)=>(g(),b(T,{class:"px-1.5 py-2 lg:px-5 lg:py-6"},{default:n(()=>[s("div",Be,[s("div",Le,[s("div",Te,[s("div",Ae,u(o.item.description),1),s("div",Fe,[s("div",null,u(o.item.sex),1),s("div",null,u(o.item.age),1)]),s("div",Me,[s("div",null,"#"+u(o.item.code),1),s("div",null,u(o.item.insurance),1)])]),s("div",Ge,[(g(!0),W(M,null,re(o.tabs,_=>(g(),W(M,{key:_.value},[_.visible?(g(),b(c,{key:0,class:L(["button-tab hover:shadow-left-secondary w-full text-xs",o.tab==_.value&&"shadow-left-secondary bg-primary text-white"]),align:"left",unelevated:"",onClick:V=>o.tab=_.value},{default:n(()=>[s("div",Ke,[s("div",Oe,[l(I,{name:_.icon},null,8,["name"]),s("span",He,u(_.label),1)])])]),_:2},1032,["onClick","class"])):w("",!0)],64))),128))])]),s("div",Je,[o.loading?w("",!0):(g(),b(ue,{key:0,modelValue:o.tab,"onUpdate:modelValue":h[0]||(h[0]=_=>o.tab=_),class:"bg-transparent"},{default:n(()=>[l(R,{name:"edit",class:"p-0"},{default:n(()=>[s("div",Xe,[l(ce,{isEdit:"",id:o.item.id,width:"100%"},null,8,["id"])])]),_:1}),l(R,{name:"insured",class:"p-0"},{default:n(()=>[l(xe,{isEdit:"",id:o.item.id,insurance_id:o.item.id,width:"100%"},null,8,["id","insurance_id"])]),_:1}),l(R,{name:"policy",class:"p-0"},{default:n(()=>[l(je,{isEdit:"",id:o.item.id,insurance_id:o.item.id,width:"100%"},null,8,["id","insurance_id"])]),_:1}),l(R,{name:"file",class:"p-0"},{default:n(()=>[l(pe,{ref_id:o.item.id,table:"t_insurance",file_type:"GENERAL"},null,8,["ref_id"]),l(fe,{refId:o.item.id,refKey:"t_insurance"},null,8,["refId"])]),_:1})]),_:1},8,["modelValue"]))]),s("div",Ye,[o.loading?w("",!0):(g(),b(me,{key:0,refKey:"t_insurance",refId:o.item.id},null,8,["refId"]))])])]),_:1}))}});export{ll as default};
